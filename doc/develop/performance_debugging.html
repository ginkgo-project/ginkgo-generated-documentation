<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ginkgo: The performance-debugging program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_doc.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Ginkgo
   &#160;<span id="projectnumber">Generated from pipelines/686532329 branch based on develop. Ginkgo version 1.5.0</span>
   </div>
   <div id="projectbrief">A numerical linear algebra library targeting many-core architectures</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The performance-debugging program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The simple solver with performance debugging example..</p>
<p>This example depends on simple-solver-logging, minimal-cuda-solver.</p>
<p> 
<table class="example" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Abouttheexample"> About the example </a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a>
    <ul>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Commentsaboutprogramminganddebugging"> Comments about programming and debugging </a>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 <a class="anchor" id="Intro"></a> <a class="anchor" id="Introduction"></a></p><h1>Introduction</h1>
<p><a class="anchor" id="Abouttheexample"></a></p><h3>About the example </h3>
<p>This example runs a solver on a test problem and shows how to use loggers to debug performance and convergence rate. <a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ginkgo/ginkgo.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unordered_map&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><span class="keyword">using</span> vec = <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;ValueType&gt;</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><span class="keyword">using</span> real_vec = <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;gko::remove_complex&lt;ValueType&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>utils {</div>
</div><!-- fragment --><p>creates a zero vector</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line">std::unique_ptr&lt;vec&lt;ValueType&gt;&gt; create_vector(</div>
<div class="line">    std::shared_ptr&lt;const gko::Executor&gt; exec, <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a> size,</div>
<div class="line">    ValueType value)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> res = vec&lt;ValueType&gt;::create(exec);</div>
<div class="line">    res-&gt;read(<a class="code" href="structgko_1_1matrix__data.html">gko::matrix_data&lt;ValueType&gt;</a>(<a class="code" href="structgko_1_1dim.html">gko::dim&lt;2&gt;</a>{size, 1}, value));</div>
<div class="line">    <span class="keywordflow">return</span> res;</div>
<div class="line">}</div>
</div><!-- fragment --><p>utilities for computing norms and residuals</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line">ValueType get_first_element(<span class="keyword">const</span> vec&lt;ValueType&gt;* norm)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> norm-&gt;get_executor()-&gt;copy_val_to_host(norm-&gt;get_const_values());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><a class="code" href="namespacegko.html#afd46d554050c4ae90e84ea4fcd9a41f3">gko::remove_complex&lt;ValueType&gt;</a> compute_norm(<span class="keyword">const</span> vec&lt;ValueType&gt;* b)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> exec = b-&gt;get_executor();</div>
<div class="line">    <span class="keyword">auto</span> b_norm = gko::initialize&lt;real_vec&lt;ValueType&gt;&gt;({0.0}, exec);</div>
<div class="line">    b-&gt;compute_norm2(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(b_norm));</div>
<div class="line">    <span class="keywordflow">return</span> get_first_element(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(b_norm));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><a class="code" href="namespacegko.html#afd46d554050c4ae90e84ea4fcd9a41f3">gko::remove_complex&lt;ValueType&gt;</a> compute_residual_norm(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* system_matrix, <span class="keyword">const</span> vec&lt;ValueType&gt;* b,</div>
<div class="line">    <span class="keyword">const</span> vec&lt;ValueType&gt;* x)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> exec = system_matrix-&gt;<a class="code" href="classgko_1_1PolymorphicObject.html#ab40586bff071b7f11c2cf6b5cbf598eb">get_executor</a>();</div>
<div class="line">    <span class="keyword">auto</span> <a class="code" href="namespacegko.html#a0059e27f8f4bc348ff65c1e60caf47c8">one</a> = gko::initialize&lt;vec&lt;ValueType&gt;&gt;({1.0}, exec);</div>
<div class="line">    <span class="keyword">auto</span> neg_one = gko::initialize&lt;vec&lt;ValueType&gt;&gt;({-1.0}, exec);</div>
<div class="line">    <span class="keyword">auto</span> res = <a class="code" href="namespacegko.html#a1beb80750459e4201aa9d882d2d074c3">gko::clone</a>(b);</div>
<div class="line">    system_matrix-&gt;<a class="code" href="classgko_1_1LinOp.html#a0449b2fc705d2f970855af23b5e2788e">apply</a>(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(one), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(x), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(neg_one),</div>
<div class="line">                         <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(res));</div>
<div class="line">    <span class="keywordflow">return</span> compute_norm(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(res));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">}  <span class="comment">// namespace utils</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>loggers {</div>
</div><!-- fragment --><p>A logger that accumulates the time of all operations. For each operation type (allocations, free, copy, internal operations i.e. kernels), the timing is taken before and after. This can create significant overhead since to ensure proper timings, calls to <code>synchronize</code> are required.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>OperationLogger : <a class="code" href="classgko_1_1log_1_1Logger.html">gko::log::Logger</a> {</div>
<div class="line">    <span class="keywordtype">void</span> on_allocation_started(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>&amp;)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        this-&gt;start_operation(exec, <span class="stringliteral">&quot;allocate&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_allocation_completed(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec,</div>
<div class="line">                                 <span class="keyword">const</span> <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>&amp;,</div>
<div class="line">                                 <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp;)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        this-&gt;end_operation(exec, <span class="stringliteral">&quot;allocate&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_free_started(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec,</div>
<div class="line">                         <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp;)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        this-&gt;start_operation(exec, <span class="stringliteral">&quot;free&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_free_completed(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec,</div>
<div class="line">                           <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp;)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        this-&gt;end_operation(exec, <span class="stringliteral">&quot;free&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_copy_started(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* from, <span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* to,</div>
<div class="line">                         <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp;, <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp;,</div>
<div class="line">                         <span class="keyword">const</span> <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>&amp;)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        from-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line">        this-&gt;start_operation(to, <span class="stringliteral">&quot;copy&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_copy_completed(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* from, <span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* to,</div>
<div class="line">                           <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp;, <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp;,</div>
<div class="line">                           <span class="keyword">const</span> <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>&amp;)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        from-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line">        this-&gt;end_operation(to, <span class="stringliteral">&quot;copy&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_operation_launched(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="classgko_1_1Operation.html">gko::Operation</a>* op)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        this-&gt;start_operation(exec, op-&gt;<a class="code" href="classgko_1_1Operation.html#ab3b940849d1daf02830f3387c52888d0">get_name</a>());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_operation_completed(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code" href="classgko_1_1Operation.html">gko::Operation</a>* op)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        this-&gt;end_operation(exec, op-&gt;<a class="code" href="classgko_1_1Operation.html#ab3b940849d1daf02830f3387c52888d0">get_name</a>());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> write_data(std::ostream&amp; ostream)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; entry : total) {</div>
<div class="line">            ostream &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; entry.first.c_str() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span></div>
<div class="line">                    &lt;&lt; std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(</div>
<div class="line">                           entry.second)</div>
<div class="line">                           .count()</div>
<div class="line">                    &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
</div><!-- fragment --><p>Helper which synchronizes and starts the time before every operation.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> start_operation(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec,</div>
<div class="line">                     <span class="keyword">const</span> std::string&amp; name)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    nested.emplace_back(0);</div>
<div class="line">    exec-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line">    start[name] = std::chrono::steady_clock::now();</div>
<div class="line">}</div>
</div><!-- fragment --><p>Helper to compute the end time and store the operation's time at its end. Also time nested operations.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> end_operation(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec, <span class="keyword">const</span> std::string&amp; name)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    exec-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> end = std::chrono::steady_clock::now();</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> diff = end - start[name];</div>
</div><!-- fragment --><p>make sure timings for nested operations are not counted twice</p>
<div class="fragment"><div class="line">    total[name] += diff - nested.back();</div>
<div class="line">    nested.pop_back();</div>
<div class="line">    <span class="keywordflow">if</span> (nested.size() &gt; 0) {</div>
<div class="line">        nested.back() += diff;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">mutable</span> std::map&lt;std::string, std::chrono::steady_clock::time_point&gt; start;</div>
<div class="line"><span class="keyword">mutable</span> std::map&lt;std::string, std::chrono::steady_clock::duration&gt; total;</div>
</div><!-- fragment --><p>the position i of this vector holds the total time spend on child operations on nesting level i</p>
<div class="fragment"><div class="line">    <span class="keyword">mutable</span> std::vector&lt;std::chrono::steady_clock::duration&gt; nested;</div>
<div class="line">};</div>
</div><!-- fragment --><p>This logger tracks the persistently allocated data</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>StorageLogger : <a class="code" href="classgko_1_1log_1_1Logger.html">gko::log::Logger</a> {</div>
</div><!-- fragment --><p>Store amount of bytes allocated on every allocation</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> on_allocation_completed(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>*,</div>
<div class="line">                             <span class="keyword">const</span> <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>&amp; num_bytes,</div>
<div class="line">                             <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp; location)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    storage[location] = num_bytes;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Reset the amount of bytes on every free</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> on_free_completed(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>*,</div>
<div class="line">                       <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp; location)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    storage[location] = 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Write the data after summing the total from all allocations</p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> write_data(std::ostream&amp; ostream)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a> total{};</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; e : storage) {</div>
<div class="line">            total += e.second;</div>
<div class="line">        }</div>
<div class="line">        ostream &lt;&lt; <span class="stringliteral">&quot;Storage: &quot;</span> &lt;&lt; total &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">mutable</span> std::unordered_map&lt;gko::uintptr, gko::size_type&gt; storage;</div>
<div class="line">};</div>
</div><!-- fragment --><p>Logs true and recurrent residuals of the solver</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><span class="keyword">struct </span>ResidualLogger : <a class="code" href="classgko_1_1log_1_1Logger.html">gko::log::Logger</a> {</div>
</div><!-- fragment --><p>Depending on the available information, store the norm or compute it from the residual. If the true residual norm could not be computed, store the value <code>-1.0</code>.</p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> on_iteration_complete(<span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>*, <span class="keyword">const</span> <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>&amp;,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* residual,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* solution,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* residual_norm)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">if</span> (residual_norm) {</div>
<div class="line">            rec_res_norms.push_back(utils::get_first_element(</div>
<div class="line">                <a class="code" href="namespacegko.html#a73ce7e87aec389b5210630bb617b4baa">gko::as</a>&lt;real_vec&lt;ValueType&gt;&gt;(residual_norm)));</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            rec_res_norms.push_back(</div>
<div class="line">                utils::compute_norm(<a class="code" href="namespacegko.html#a73ce7e87aec389b5210630bb617b4baa">gko::as</a>&lt;vec&lt;ValueType&gt;&gt;(residual)));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (solution) {</div>
<div class="line">            true_res_norms.push_back(utils::compute_residual_norm(</div>
<div class="line">                matrix, b, <a class="code" href="namespacegko.html#a73ce7e87aec389b5210630bb617b4baa">gko::as</a>&lt;vec&lt;ValueType&gt;&gt;(solution)));</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            true_res_norms.push_back(-1.0);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ResidualLogger(<span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* matrix, <span class="keyword">const</span> vec&lt;ValueType&gt;* b)</div>
<div class="line">        : <a class="code" href="namespacegko.html">gko</a>::log::Logger(<a class="code" href="namespacegko.html">gko</a>::log::Logger::iteration_complete_mask),</div>
<div class="line">          matrix{matrix},</div>
<div class="line">          b{b}</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> write_data(std::ostream&amp; ostream)</div>
<div class="line">    {</div>
<div class="line">        ostream &lt;&lt; <span class="stringliteral">&quot;Recurrent Residual Norms: &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        ostream &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; entry : rec_res_norms) {</div>
<div class="line">            ostream &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; entry &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">        ostream &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        ostream &lt;&lt; <span class="stringliteral">&quot;True Residual Norms: &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        ostream &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; entry : true_res_norms) {</div>
<div class="line">            ostream &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; entry &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">        ostream &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* matrix;</div>
<div class="line">    <span class="keyword">const</span> vec&lt;ValueType&gt;* b;</div>
<div class="line">    <span class="keyword">mutable</span> std::vector&lt;gko::remove_complex&lt;ValueType&gt;&gt; rec_res_norms;</div>
<div class="line">    <span class="keyword">mutable</span> std::vector&lt;gko::remove_complex&lt;ValueType&gt;&gt; true_res_norms;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">}  <span class="comment">// namespace loggers</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>{</div>
</div><!-- fragment --><p>Print usage help</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> print_usage(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename)</div>
<div class="line">{</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot; [executor] [matrix file]&quot;</span></div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;matrix file should be a file in matrix market format. &quot;</span></div>
<div class="line">                 <span class="stringliteral">&quot;The file data/A.mtx is provided as an example.&quot;</span></div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">    std::exit(-1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><span class="keywordtype">void</span> print_vector(<span class="keyword">const</span> <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;ValueType&gt;</a>* vec)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> elements_to_print = std::min(<a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>(10), vec-&gt;<a class="code" href="classgko_1_1LinOp.html#a31b3c003388eb0b95393154f68c2b98d">get_size</a>()[0]);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; elements_to_print; ++i) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; vec-&gt;<a class="code" href="classgko_1_1matrix_1_1Dense.html#af0f1af68853537807ca271a296de3cd0">at</a>(i) &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">}  <span class="comment">// namespace</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
</div><!-- fragment --><p>Parametrize the benchmark here Pick a value type</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> ValueType = double;</div>
<div class="line"><span class="keyword">using</span> IndexType = int;</div>
</div><!-- fragment --><p>Pick a matrix format</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> mtx = <a class="code" href="classgko_1_1matrix_1_1Csr.html">gko::matrix::Csr&lt;ValueType, IndexType&gt;</a>;</div>
</div><!-- fragment --><p>Pick a solver</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> solver = <a class="code" href="classgko_1_1solver_1_1Cg.html">gko::solver::Cg&lt;ValueType&gt;</a>;</div>
</div><!-- fragment --><p>Pick a preconditioner type</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> preconditioner = <a class="code" href="classgko_1_1matrix_1_1IdentityFactory.html">gko::matrix::IdentityFactory&lt;ValueType&gt;</a>;</div>
</div><!-- fragment --><p>Pick a residual norm reduction value</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="namespacegko.html#afd46d554050c4ae90e84ea4fcd9a41f3">gko::remove_complex&lt;ValueType&gt;</a> reduction_factor = 1e-12;</div>
</div><!-- fragment --><p>Pick an output file name</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> of_name = <span class="stringliteral">&quot;log.txt&quot;</span>;</div>
</div><!-- fragment --><p>Simple shortcut</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> vec = <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;ValueType&gt;</a>;</div>
</div><!-- fragment --><p>Print version information</p>
<div class="fragment"><div class="line">std::cout &lt;&lt; <a class="code" href="classgko_1_1version__info.html#a6daeb8a087cfb57fa055526fc133d8eb">gko::version_info::get</a>() &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>Figure out where to run the code</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (argc == 2 &amp;&amp; (std::string(argv[1]) == <span class="stringliteral">&quot;--help&quot;</span>)) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; [executor]&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::exit(-1);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Figure out where to run the code</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> executor_string = argc &gt;= 2 ? argv[1] : <span class="stringliteral">&quot;reference&quot;</span>;</div>
<div class="line">std::map&lt;std::string, std::function&lt;std::shared_ptr&lt;gko::Executor&gt;()&gt;&gt;</div>
<div class="line">    exec_map{</div>
<div class="line">        {<span class="stringliteral">&quot;omp&quot;</span>, [] { <span class="keywordflow">return</span> <a class="code" href="classgko_1_1OmpExecutor.html#a33ca05fdd0fc928ee262fc9425304874">gko::OmpExecutor::create</a>(); }},</div>
<div class="line">        {<span class="stringliteral">&quot;cuda&quot;</span>,</div>
<div class="line">         [] {</div>
<div class="line">             <span class="keywordflow">return</span> <a class="code" href="classgko_1_1CudaExecutor.html#a5dcec3ca1c458382e01191b727959a81">gko::CudaExecutor::create</a>(0, <a class="code" href="classgko_1_1OmpExecutor.html#a33ca05fdd0fc928ee262fc9425304874">gko::OmpExecutor::create</a>(),</div>
<div class="line">                                              <span class="keyword">true</span>);</div>
<div class="line">         }},</div>
<div class="line">        {<span class="stringliteral">&quot;hip&quot;</span>,</div>
<div class="line">         [] {</div>
<div class="line">             <span class="keywordflow">return</span> <a class="code" href="classgko_1_1HipExecutor.html#ad3a72bc42254fb8730bc2090147447d9">gko::HipExecutor::create</a>(0, <a class="code" href="classgko_1_1OmpExecutor.html#a33ca05fdd0fc928ee262fc9425304874">gko::OmpExecutor::create</a>(),</div>
<div class="line">                                             <span class="keyword">true</span>);</div>
<div class="line">         }},</div>
<div class="line">        {<span class="stringliteral">&quot;dpcpp&quot;</span>,</div>
<div class="line">         [] {</div>
<div class="line">             <span class="keywordflow">return</span> <a class="code" href="classgko_1_1DpcppExecutor.html#ae9b875dfe3af7f3f3f24071bfb2f895e">gko::DpcppExecutor::create</a>(0,</div>
<div class="line">                                               <a class="code" href="classgko_1_1OmpExecutor.html#a33ca05fdd0fc928ee262fc9425304874">gko::OmpExecutor::create</a>());</div>
<div class="line">         }},</div>
<div class="line">        {<span class="stringliteral">&quot;reference&quot;</span>, [] { <span class="keywordflow">return</span> gko::ReferenceExecutor::create(); }}};</div>
</div><!-- fragment --><p>executor where Ginkgo will perform the computation</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> exec = exec_map.at(executor_string)();  <span class="comment">// throws if not valid</span></div>
</div><!-- fragment --><p>Read the input matrix file directory</p>
<div class="fragment"><div class="line">std::string input_mtx = <span class="stringliteral">&quot;data/A.mtx&quot;</span>;</div>
<div class="line"><span class="keywordflow">if</span> (argc == 3) {</div>
<div class="line">    input_mtx = std::string(argv[2]);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Read data: A is read from disk Create a StorageLogger to track the size of A</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> storage_logger = std::make_shared&lt;loggers::StorageLogger&gt;();</div>
</div><!-- fragment --><p>Add the logger to the executor</p>
<div class="fragment"><div class="line">exec-&gt;add_logger(storage_logger);</div>
</div><!-- fragment --><p>Read the matrix A from file</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> A = <a class="code" href="namespacegko.html#a3ce296f73db0ff398bdea6009a3a5c58">gko::share</a>(gko::read&lt;mtx&gt;(std::ifstream(input_mtx), exec));</div>
</div><!-- fragment --><p>Remove the storage logger</p>
<div class="fragment"><div class="line">exec-&gt;remove_logger(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(storage_logger));</div>
</div><!-- fragment --><p>Pick a maximum iteration count</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> max_iters = A-&gt;get_size()[0];</div>
</div><!-- fragment --><p>Generate b and x vectors</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> b = utils::create_vector&lt;ValueType&gt;(exec, A-&gt;get_size()[0], 1.0);</div>
<div class="line"><span class="keyword">auto</span> x = utils::create_vector&lt;ValueType&gt;(exec, A-&gt;get_size()[0], 0.0);</div>
</div><!-- fragment --><p>Declare the solver factory. The preconditioner's arguments should be adapted if needed.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> solver_factory =</div>
<div class="line">    solver::build()</div>
<div class="line">        .with_criteria(</div>
<div class="line">            <a class="code" href="classgko_1_1stop_1_1ResidualNorm.html">gko::stop::ResidualNorm&lt;ValueType&gt;::build</a>()</div>
<div class="line">                .with_reduction_factor(reduction_factor)</div>
<div class="line">                .on(exec),</div>
<div class="line">            gko::stop::Iteration::build().with_max_iters(max_iters).on(</div>
<div class="line">                exec))</div>
<div class="line">        .with_preconditioner(preconditioner::create(exec))</div>
<div class="line">        .on(exec);</div>
</div><!-- fragment --><p>Declare the output file for all our loggers</p>
<div class="fragment"><div class="line">std::ofstream output_file(of_name);</div>
</div><!-- fragment --><p>Do a warmup run</p>
<div class="fragment"><div class="line">{</div>
</div><!-- fragment --><p>Clone x to not overwrite the original one</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> x_clone = <a class="code" href="namespacegko.html#a1beb80750459e4201aa9d882d2d074c3">gko::clone</a>(x);</div>
</div><!-- fragment --><p>Generate and call apply on a solver</p>
<div class="fragment"><div class="line">    solver_factory-&gt;generate(A)-&gt;apply(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(b), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(x_clone));</div>
<div class="line">    exec-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p>Do a timed run</p>
<div class="fragment"><div class="line">{</div>
</div><!-- fragment --><p>Clone x to not overwrite the original one</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> x_clone = <a class="code" href="namespacegko.html#a1beb80750459e4201aa9d882d2d074c3">gko::clone</a>(x);</div>
</div><!-- fragment --><p>Synchronize ensures no operation are ongoing</p>
<div class="fragment"><div class="line">exec-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
</div><!-- fragment --><p>Time before generate</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> g_tic = std::chrono::steady_clock::now();</div>
</div><!-- fragment --><p>Generate a solver</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> generated_solver = solver_factory-&gt;generate(A);</div>
<div class="line">exec-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
</div><!-- fragment --><p>Time after generate</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> g_tac = std::chrono::steady_clock::now();</div>
</div><!-- fragment --><p>Compute the generation time</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> generate_time =</div>
<div class="line">    std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(g_tac - g_tic);</div>
</div><!-- fragment --><p>Write the generate time to the output file</p>
<div class="fragment"><div class="line">output_file &lt;&lt; <span class="stringliteral">&quot;Generate time (ns): &quot;</span> &lt;&lt; generate_time.count()</div>
<div class="line">            &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>Similarly time the apply</p>
<div class="fragment"><div class="line">exec-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line"><span class="keyword">auto</span> a_tic = std::chrono::steady_clock::now();</div>
<div class="line">generated_solver-&gt;apply(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(b), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(x_clone));</div>
<div class="line">exec-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line"><span class="keyword">auto</span> a_tac = std::chrono::steady_clock::now();</div>
<div class="line"><span class="keyword">auto</span> apply_time =</div>
<div class="line">    std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(a_tac - a_tic);</div>
<div class="line">output_file &lt;&lt; <span class="stringliteral">&quot;Apply time (ns): &quot;</span> &lt;&lt; apply_time.count() &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>Compute the residual norm</p>
<div class="fragment"><div class="line">    <span class="keyword">auto</span> residual = utils::compute_residual_norm(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(A), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(b),</div>
<div class="line">                                                 <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(x_clone));</div>
<div class="line">    output_file &lt;&lt; <span class="stringliteral">&quot;Residual_norm: &quot;</span> &lt;&lt; residual &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Log the internal operations using the OperationLogger without timing</p>
<div class="fragment"><div class="line">{</div>
</div><!-- fragment --><p>Create an OperationLogger to analyze the generate step</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> gen_logger = std::make_shared&lt;loggers::OperationLogger&gt;();</div>
</div><!-- fragment --><p>Add the generate logger to the executor</p>
<div class="fragment"><div class="line">exec-&gt;add_logger(gen_logger);</div>
</div><!-- fragment --><p>Generate a solver</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> generated_solver = solver_factory-&gt;generate(A);</div>
</div><!-- fragment --><p>Remove the generate logger from the executor</p>
<div class="fragment"><div class="line">exec-&gt;remove_logger(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(gen_logger));</div>
</div><!-- fragment --><p>Write the data to the output file</p>
<div class="fragment"><div class="line">output_file &lt;&lt; <span class="stringliteral">&quot;Generate operations times (ns):&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">gen_logger-&gt;write_data(output_file);</div>
</div><!-- fragment --><p>Create an OperationLogger to analyze the apply step</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> apply_logger = std::make_shared&lt;loggers::OperationLogger&gt;();</div>
<div class="line">exec-&gt;add_logger(apply_logger);</div>
</div><!-- fragment --><p>Create a ResidualLogger to log the recurent residual</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> res_logger = std::make_shared&lt;loggers::ResidualLogger&lt;ValueType&gt;&gt;(</div>
<div class="line">    <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(A), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(b));</div>
<div class="line">generated_solver-&gt;add_logger(res_logger);</div>
</div><!-- fragment --><p>Solve the system</p>
<div class="fragment"><div class="line">generated_solver-&gt;apply(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(b), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(x));</div>
<div class="line">exec-&gt;remove_logger(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(apply_logger));</div>
</div><!-- fragment --><p>Write the data to the output file</p>
<div class="fragment"><div class="line">    output_file &lt;&lt; <span class="stringliteral">&quot;Apply operations times (ns):&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    apply_logger-&gt;write_data(output_file);</div>
<div class="line">    res_logger-&gt;write_data(output_file);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Print solution</p>
<div class="fragment"><div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Solution, first ten entries: \n&quot;</span>;</div>
<div class="line">print_vector(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(x));</div>
</div><!-- fragment --><p>Print output file location</p>
<div class="fragment"><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;The performance and residual data can be found in &quot;</span> &lt;&lt; of_name</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>This is the expected standard output:</p>
<div class="fragment"><div class="line">Solution, first ten entries:</div>
<div class="line">[</div>
<div class="line">    0.252218</div>
<div class="line">    0.108645</div>
<div class="line">    0.0662811</div>
<div class="line">    0.0630433</div>
<div class="line">    0.0384088</div>
<div class="line">    0.0396536</div>
<div class="line">    0.0402648</div>
<div class="line">    0.0338935</div>
<div class="line">    0.0193098</div>
<div class="line">    0.0234653</div>
<div class="line">];</div>
<div class="line">The performance and residual data can be found in log.txt</div>
</div><!-- fragment --><p>Here is a sample output in the file log.txt: </p><div class="fragment"><div class="line">Generate time (ns): 861</div>
<div class="line">Apply time (ns): 108144</div>
<div class="line">Residual_norm: 2.10788e-15</div>
<div class="line">Generate operations times (ns):</div>
<div class="line">Apply operations times (ns):</div>
<div class="line">    allocate: 14991</div>
<div class="line">    cg::<a class="code" href="group__LinOp.html#ga2f54bac1e95fb3ef03974fa9c9088491">initialize</a>#8: 872</div>
<div class="line">    cg::step_1#5: 7683</div>
<div class="line">    cg::step_2#7: 7756</div>
<div class="line">    copy: 7751</div>
<div class="line">    csr::advanced_spmv#5: 21819</div>
<div class="line">    csr::spmv#3: 20429</div>
<div class="line">    dense::compute_dot#3: 18043</div>
<div class="line">    dense::compute_norm2#2: 16726</div>
<div class="line">    free: 8857</div>
<div class="line">    residual_norm::residual_norm#9: 3614</div>
<div class="line">Recurrent Residual Norms:</div>
<div class="line">[</div>
<div class="line">    4.3589</div>
<div class="line">    2.30455</div>
<div class="line">    1.46771</div>
<div class="line">    0.984875</div>
<div class="line">    0.741833</div>
<div class="line">    0.513623</div>
<div class="line">    0.384165</div>
<div class="line">    0.316439</div>
<div class="line">    0.227709</div>
<div class="line">    0.170312</div>
<div class="line">    0.0973722</div>
<div class="line">    0.0616831</div>
<div class="line">    0.0454123</div>
<div class="line">    0.031953</div>
<div class="line">    0.0161606</div>
<div class="line">    0.00657015</div>
<div class="line">    0.00264367</div>
<div class="line">    0.000858809</div>
<div class="line">    0.000286461</div>
<div class="line">    1.64195e-15</div>
<div class="line">];</div>
<div class="line">True Residual Norms:</div>
<div class="line">[</div>
<div class="line">    4.3589</div>
<div class="line">    2.30455</div>
<div class="line">    1.46771</div>
<div class="line">    0.984875</div>
<div class="line">    0.741833</div>
<div class="line">    0.513623</div>
<div class="line">    0.384165</div>
<div class="line">    0.316439</div>
<div class="line">    0.227709</div>
<div class="line">    0.170312</div>
<div class="line">    0.0973722</div>
<div class="line">    0.0616831</div>
<div class="line">    0.0454123</div>
<div class="line">    0.031953</div>
<div class="line">    0.0161606</div>
<div class="line">    0.00657015</div>
<div class="line">    0.00264367</div>
<div class="line">    0.000858809</div>
<div class="line">    0.000286461</div>
<div class="line">    2.10788e-15</div>
<div class="line">];</div>
</div><!-- fragment --><p><a class="anchor" id="Commentsaboutprogramminganddebugging"></a></p><h3>Comments about programming and debugging </h3>
<p><a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/*******************************&lt;GINKGO LICENSE&gt;******************************</span></div>
<div class="line"><span class="comment">Copyright (c) 2017-2022, the Ginkgo authors</span></div>
<div class="line"><span class="comment">All rights reserved.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment">modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment">are met:</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">1. Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment">notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">2. Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment">notice, this list of conditions and the following disclaimer in the</span></div>
<div class="line"><span class="comment">documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">3. Neither the name of the copyright holder nor the names of its</span></div>
<div class="line"><span class="comment">contributors may be used to endorse or promote products derived from</span></div>
<div class="line"><span class="comment">this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS</span></div>
<div class="line"><span class="comment">IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED</span></div>
<div class="line"><span class="comment">TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A</span></div>
<div class="line"><span class="comment">PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment">HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment">SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment">LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment">DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment">THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment">(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment">OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment">******************************&lt;GINKGO LICENSE&gt;*******************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;ginkgo/ginkgo.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unordered_map&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><span class="keyword">using</span> vec = <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;ValueType&gt;</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><span class="keyword">using</span> real_vec = <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;gko::remove_complex&lt;ValueType&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>utils {</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line">std::unique_ptr&lt;vec&lt;ValueType&gt;&gt; create_vector(</div>
<div class="line">    std::shared_ptr&lt;const gko::Executor&gt; exec, <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a> size,</div>
<div class="line">    ValueType value)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> res = vec&lt;ValueType&gt;::create(exec);</div>
<div class="line">    res-&gt;read(<a class="code" href="structgko_1_1matrix__data.html">gko::matrix_data&lt;ValueType&gt;</a>(<a class="code" href="structgko_1_1dim.html">gko::dim&lt;2&gt;</a>{size, 1}, value));</div>
<div class="line">    <span class="keywordflow">return</span> res;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line">ValueType get_first_element(<span class="keyword">const</span> vec&lt;ValueType&gt;* norm)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> norm-&gt;get_executor()-&gt;copy_val_to_host(norm-&gt;get_const_values());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><a class="code" href="namespacegko.html#afd46d554050c4ae90e84ea4fcd9a41f3">gko::remove_complex&lt;ValueType&gt;</a> compute_norm(<span class="keyword">const</span> vec&lt;ValueType&gt;* b)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> exec = b-&gt;get_executor();</div>
<div class="line">    <span class="keyword">auto</span> b_norm = gko::initialize&lt;real_vec&lt;ValueType&gt;&gt;({0.0}, exec);</div>
<div class="line">    b-&gt;compute_norm2(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(b_norm));</div>
<div class="line">    <span class="keywordflow">return</span> get_first_element(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(b_norm));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><a class="code" href="namespacegko.html#afd46d554050c4ae90e84ea4fcd9a41f3">gko::remove_complex&lt;ValueType&gt;</a> compute_residual_norm(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* system_matrix, <span class="keyword">const</span> vec&lt;ValueType&gt;* b,</div>
<div class="line">    <span class="keyword">const</span> vec&lt;ValueType&gt;* x)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> exec = system_matrix-&gt;<a class="code" href="classgko_1_1PolymorphicObject.html#ab40586bff071b7f11c2cf6b5cbf598eb">get_executor</a>();</div>
<div class="line">    <span class="keyword">auto</span> <a class="code" href="namespacegko.html#a0059e27f8f4bc348ff65c1e60caf47c8">one</a> = gko::initialize&lt;vec&lt;ValueType&gt;&gt;({1.0}, exec);</div>
<div class="line">    <span class="keyword">auto</span> neg_one = gko::initialize&lt;vec&lt;ValueType&gt;&gt;({-1.0}, exec);</div>
<div class="line">    <span class="keyword">auto</span> res = <a class="code" href="namespacegko.html#a1beb80750459e4201aa9d882d2d074c3">gko::clone</a>(b);</div>
<div class="line">    system_matrix-&gt;<a class="code" href="classgko_1_1LinOp.html#a0449b2fc705d2f970855af23b5e2788e">apply</a>(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(one), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(x), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(neg_one),</div>
<div class="line">                         <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(res));</div>
<div class="line">    <span class="keywordflow">return</span> compute_norm(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(res));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">}  <span class="comment">// namespace utils</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>loggers {</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>OperationLogger : <a class="code" href="classgko_1_1log_1_1Logger.html">gko::log::Logger</a> {</div>
<div class="line">    <span class="keywordtype">void</span> on_allocation_started(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>&amp;)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        this-&gt;start_operation(exec, <span class="stringliteral">&quot;allocate&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_allocation_completed(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec,</div>
<div class="line">                                 <span class="keyword">const</span> <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>&amp;,</div>
<div class="line">                                 <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp;)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        this-&gt;end_operation(exec, <span class="stringliteral">&quot;allocate&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_free_started(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec,</div>
<div class="line">                         <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp;)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        this-&gt;start_operation(exec, <span class="stringliteral">&quot;free&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_free_completed(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec,</div>
<div class="line">                           <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp;)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        this-&gt;end_operation(exec, <span class="stringliteral">&quot;free&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_copy_started(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* from, <span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* to,</div>
<div class="line">                         <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp;, <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp;,</div>
<div class="line">                         <span class="keyword">const</span> <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>&amp;)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        from-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line">        this-&gt;start_operation(to, <span class="stringliteral">&quot;copy&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_copy_completed(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* from, <span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* to,</div>
<div class="line">                           <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp;, <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp;,</div>
<div class="line">                           <span class="keyword">const</span> <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>&amp;)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        from-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line">        this-&gt;end_operation(to, <span class="stringliteral">&quot;copy&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_operation_launched(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="classgko_1_1Operation.html">gko::Operation</a>* op)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        this-&gt;start_operation(exec, op-&gt;<a class="code" href="classgko_1_1Operation.html#ab3b940849d1daf02830f3387c52888d0">get_name</a>());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_operation_completed(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code" href="classgko_1_1Operation.html">gko::Operation</a>* op)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        this-&gt;end_operation(exec, op-&gt;<a class="code" href="classgko_1_1Operation.html#ab3b940849d1daf02830f3387c52888d0">get_name</a>());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> write_data(std::ostream&amp; ostream)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; entry : total) {</div>
<div class="line">            ostream &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; entry.first.c_str() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span></div>
<div class="line">                    &lt;&lt; std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(</div>
<div class="line">                           entry.second)</div>
<div class="line">                           .count()</div>
<div class="line">                    &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> start_operation(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec,</div>
<div class="line">                         <span class="keyword">const</span> std::string&amp; name)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        nested.emplace_back(0);</div>
<div class="line">        exec-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line">        start[name] = std::chrono::steady_clock::now();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> end_operation(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>* exec, <span class="keyword">const</span> std::string&amp; name)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        exec-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span> end = std::chrono::steady_clock::now();</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span> diff = end - start[name];</div>
<div class="line">        total[name] += diff - nested.back();</div>
<div class="line">        nested.pop_back();</div>
<div class="line">        <span class="keywordflow">if</span> (nested.size() &gt; 0) {</div>
<div class="line">            nested.back() += diff;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">mutable</span> std::map&lt;std::string, std::chrono::steady_clock::time_point&gt; start;</div>
<div class="line">    <span class="keyword">mutable</span> std::map&lt;std::string, std::chrono::steady_clock::duration&gt; total;</div>
<div class="line">    <span class="keyword">mutable</span> std::vector&lt;std::chrono::steady_clock::duration&gt; nested;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>StorageLogger : <a class="code" href="classgko_1_1log_1_1Logger.html">gko::log::Logger</a> {</div>
<div class="line">    <span class="keywordtype">void</span> on_allocation_completed(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>*,</div>
<div class="line">                                 <span class="keyword">const</span> <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>&amp; num_bytes,</div>
<div class="line">                                 <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp; location)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        storage[location] = num_bytes;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_free_completed(<span class="keyword">const</span> <a class="code" href="classgko_1_1Executor.html">gko::Executor</a>*,</div>
<div class="line">                           <span class="keyword">const</span> <a class="code" href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a>&amp; location)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        storage[location] = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> write_data(std::ostream&amp; ostream)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a> total{};</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; e : storage) {</div>
<div class="line">            total += e.second;</div>
<div class="line">        }</div>
<div class="line">        ostream &lt;&lt; <span class="stringliteral">&quot;Storage: &quot;</span> &lt;&lt; total &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">mutable</span> std::unordered_map&lt;gko::uintptr, gko::size_type&gt; storage;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><span class="keyword">struct </span>ResidualLogger : <a class="code" href="classgko_1_1log_1_1Logger.html">gko::log::Logger</a> {</div>
<div class="line">    <span class="keywordtype">void</span> on_iteration_complete(<span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>*, <span class="keyword">const</span> <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>&amp;,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* residual,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* solution,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* residual_norm)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">if</span> (residual_norm) {</div>
<div class="line">            rec_res_norms.push_back(utils::get_first_element(</div>
<div class="line">                <a class="code" href="namespacegko.html#a73ce7e87aec389b5210630bb617b4baa">gko::as</a>&lt;real_vec&lt;ValueType&gt;&gt;(residual_norm)));</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            rec_res_norms.push_back(</div>
<div class="line">                utils::compute_norm(<a class="code" href="namespacegko.html#a73ce7e87aec389b5210630bb617b4baa">gko::as</a>&lt;vec&lt;ValueType&gt;&gt;(residual)));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (solution) {</div>
<div class="line">            true_res_norms.push_back(utils::compute_residual_norm(</div>
<div class="line">                matrix, b, <a class="code" href="namespacegko.html#a73ce7e87aec389b5210630bb617b4baa">gko::as</a>&lt;vec&lt;ValueType&gt;&gt;(solution)));</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            true_res_norms.push_back(-1.0);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ResidualLogger(<span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* matrix, <span class="keyword">const</span> vec&lt;ValueType&gt;* b)</div>
<div class="line">        : <a class="code" href="namespacegko.html">gko</a>::log::Logger(<a class="code" href="namespacegko.html">gko</a>::log::Logger::iteration_complete_mask),</div>
<div class="line">          matrix{matrix},</div>
<div class="line">          b{b}</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> write_data(std::ostream&amp; ostream)</div>
<div class="line">    {</div>
<div class="line">        ostream &lt;&lt; <span class="stringliteral">&quot;Recurrent Residual Norms: &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        ostream &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; entry : rec_res_norms) {</div>
<div class="line">            ostream &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; entry &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">        ostream &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        ostream &lt;&lt; <span class="stringliteral">&quot;True Residual Norms: &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        ostream &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; entry : true_res_norms) {</div>
<div class="line">            ostream &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; entry &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">        ostream &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* matrix;</div>
<div class="line">    <span class="keyword">const</span> vec&lt;ValueType&gt;* b;</div>
<div class="line">    <span class="keyword">mutable</span> std::vector&lt;gko::remove_complex&lt;ValueType&gt;&gt; rec_res_norms;</div>
<div class="line">    <span class="keyword">mutable</span> std::vector&lt;gko::remove_complex&lt;ValueType&gt;&gt; true_res_norms;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">}  <span class="comment">// namespace loggers</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>{</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> print_usage(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename)</div>
<div class="line">{</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot; [executor] [matrix file]&quot;</span></div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;matrix file should be a file in matrix market format. &quot;</span></div>
<div class="line">                 <span class="stringliteral">&quot;The file data/A.mtx is provided as an example.&quot;</span></div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">    std::exit(-1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><span class="keywordtype">void</span> print_vector(<span class="keyword">const</span> <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;ValueType&gt;</a>* vec)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> elements_to_print = std::min(<a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>(10), vec-&gt;<a class="code" href="classgko_1_1LinOp.html#a31b3c003388eb0b95393154f68c2b98d">get_size</a>()[0]);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; elements_to_print; ++i) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; vec-&gt;<a class="code" href="classgko_1_1matrix_1_1Dense.html#af0f1af68853537807ca271a296de3cd0">at</a>(i) &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">}  <span class="comment">// namespace</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using</span> ValueType = double;</div>
<div class="line">    <span class="keyword">using</span> IndexType = int;</div>
<div class="line">    <span class="keyword">using</span> mtx = <a class="code" href="classgko_1_1matrix_1_1Csr.html">gko::matrix::Csr&lt;ValueType, IndexType&gt;</a>;</div>
<div class="line">    <span class="keyword">using</span> solver = <a class="code" href="classgko_1_1solver_1_1Cg.html">gko::solver::Cg&lt;ValueType&gt;</a>;</div>
<div class="line">    <span class="keyword">using</span> preconditioner = <a class="code" href="classgko_1_1matrix_1_1IdentityFactory.html">gko::matrix::IdentityFactory&lt;ValueType&gt;</a>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="namespacegko.html#afd46d554050c4ae90e84ea4fcd9a41f3">gko::remove_complex&lt;ValueType&gt;</a> reduction_factor = 1e-12;</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> of_name = <span class="stringliteral">&quot;log.txt&quot;</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> vec = <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;ValueType&gt;</a>;</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <a class="code" href="classgko_1_1version__info.html#a6daeb8a087cfb57fa055526fc133d8eb">gko::version_info::get</a>() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (argc == 2 &amp;&amp; (std::string(argv[1]) == <span class="stringliteral">&quot;--help&quot;</span>)) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; [executor]&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        std::exit(-1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> executor_string = argc &gt;= 2 ? argv[1] : <span class="stringliteral">&quot;reference&quot;</span>;</div>
<div class="line">    std::map&lt;std::string, std::function&lt;std::shared_ptr&lt;gko::Executor&gt;()&gt;&gt;</div>
<div class="line">        exec_map{</div>
<div class="line">            {<span class="stringliteral">&quot;omp&quot;</span>, [] { <span class="keywordflow">return</span> <a class="code" href="classgko_1_1OmpExecutor.html#a33ca05fdd0fc928ee262fc9425304874">gko::OmpExecutor::create</a>(); }},</div>
<div class="line">            {<span class="stringliteral">&quot;cuda&quot;</span>,</div>
<div class="line">             [] {</div>
<div class="line">                 <span class="keywordflow">return</span> <a class="code" href="classgko_1_1CudaExecutor.html#a5dcec3ca1c458382e01191b727959a81">gko::CudaExecutor::create</a>(0, <a class="code" href="classgko_1_1OmpExecutor.html#a33ca05fdd0fc928ee262fc9425304874">gko::OmpExecutor::create</a>(),</div>
<div class="line">                                                  <span class="keyword">true</span>);</div>
<div class="line">             }},</div>
<div class="line">            {<span class="stringliteral">&quot;hip&quot;</span>,</div>
<div class="line">             [] {</div>
<div class="line">                 <span class="keywordflow">return</span> <a class="code" href="classgko_1_1HipExecutor.html#ad3a72bc42254fb8730bc2090147447d9">gko::HipExecutor::create</a>(0, <a class="code" href="classgko_1_1OmpExecutor.html#a33ca05fdd0fc928ee262fc9425304874">gko::OmpExecutor::create</a>(),</div>
<div class="line">                                                 <span class="keyword">true</span>);</div>
<div class="line">             }},</div>
<div class="line">            {<span class="stringliteral">&quot;dpcpp&quot;</span>,</div>
<div class="line">             [] {</div>
<div class="line">                 <span class="keywordflow">return</span> <a class="code" href="classgko_1_1DpcppExecutor.html#ae9b875dfe3af7f3f3f24071bfb2f895e">gko::DpcppExecutor::create</a>(0,</div>
<div class="line">                                                   <a class="code" href="classgko_1_1OmpExecutor.html#a33ca05fdd0fc928ee262fc9425304874">gko::OmpExecutor::create</a>());</div>
<div class="line">             }},</div>
<div class="line">            {<span class="stringliteral">&quot;reference&quot;</span>, [] { <span class="keywordflow">return</span> gko::ReferenceExecutor::create(); }}};</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> exec = exec_map.at(executor_string)();  <span class="comment">// throws if not valid</span></div>
<div class="line"> </div>
<div class="line">    std::string input_mtx = <span class="stringliteral">&quot;data/A.mtx&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (argc == 3) {</div>
<div class="line">        input_mtx = std::string(argv[2]);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> storage_logger = std::make_shared&lt;loggers::StorageLogger&gt;();</div>
<div class="line">    exec-&gt;add_logger(storage_logger);</div>
<div class="line">    <span class="keyword">auto</span> A = <a class="code" href="namespacegko.html#a3ce296f73db0ff398bdea6009a3a5c58">gko::share</a>(gko::read&lt;mtx&gt;(std::ifstream(input_mtx), exec));</div>
<div class="line">    exec-&gt;remove_logger(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(storage_logger));</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> max_iters = A-&gt;get_size()[0];</div>
<div class="line">    <span class="keyword">auto</span> b = utils::create_vector&lt;ValueType&gt;(exec, A-&gt;get_size()[0], 1.0);</div>
<div class="line">    <span class="keyword">auto</span> x = utils::create_vector&lt;ValueType&gt;(exec, A-&gt;get_size()[0], 0.0);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> solver_factory =</div>
<div class="line">        solver::build()</div>
<div class="line">            .with_criteria(</div>
<div class="line">                <a class="code" href="classgko_1_1stop_1_1ResidualNorm.html">gko::stop::ResidualNorm&lt;ValueType&gt;::build</a>()</div>
<div class="line">                    .with_reduction_factor(reduction_factor)</div>
<div class="line">                    .on(exec),</div>
<div class="line">                gko::stop::Iteration::build().with_max_iters(max_iters).on(</div>
<div class="line">                    exec))</div>
<div class="line">            .with_preconditioner(preconditioner::create(exec))</div>
<div class="line">            .on(exec);</div>
<div class="line"> </div>
<div class="line">    std::ofstream output_file(of_name);</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> x_clone = <a class="code" href="namespacegko.html#a1beb80750459e4201aa9d882d2d074c3">gko::clone</a>(x);</div>
<div class="line"> </div>
<div class="line">        solver_factory-&gt;generate(A)-&gt;apply(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(b), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(x_clone));</div>
<div class="line">        exec-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> x_clone = <a class="code" href="namespacegko.html#a1beb80750459e4201aa9d882d2d074c3">gko::clone</a>(x);</div>
<div class="line"> </div>
<div class="line">        exec-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line">        <span class="keyword">auto</span> g_tic = std::chrono::steady_clock::now();</div>
<div class="line">        <span class="keyword">auto</span> generated_solver = solver_factory-&gt;generate(A);</div>
<div class="line">        exec-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line">        <span class="keyword">auto</span> g_tac = std::chrono::steady_clock::now();</div>
<div class="line">        <span class="keyword">auto</span> generate_time =</div>
<div class="line">            std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(g_tac - g_tic);</div>
<div class="line">        output_file &lt;&lt; <span class="stringliteral">&quot;Generate time (ns): &quot;</span> &lt;&lt; generate_time.count()</div>
<div class="line">                    &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        exec-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line">        <span class="keyword">auto</span> a_tic = std::chrono::steady_clock::now();</div>
<div class="line">        generated_solver-&gt;apply(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(b), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(x_clone));</div>
<div class="line">        exec-&gt;<a class="code" href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">synchronize</a>();</div>
<div class="line">        <span class="keyword">auto</span> a_tac = std::chrono::steady_clock::now();</div>
<div class="line">        <span class="keyword">auto</span> apply_time =</div>
<div class="line">            std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(a_tac - a_tic);</div>
<div class="line">        output_file &lt;&lt; <span class="stringliteral">&quot;Apply time (ns): &quot;</span> &lt;&lt; apply_time.count() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> residual = utils::compute_residual_norm(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(A), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(b),</div>
<div class="line">                                                     <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(x_clone));</div>
<div class="line">        output_file &lt;&lt; <span class="stringliteral">&quot;Residual_norm: &quot;</span> &lt;&lt; residual &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> gen_logger = std::make_shared&lt;loggers::OperationLogger&gt;();</div>
<div class="line">        exec-&gt;add_logger(gen_logger);</div>
<div class="line">        <span class="keyword">auto</span> generated_solver = solver_factory-&gt;generate(A);</div>
<div class="line">        exec-&gt;remove_logger(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(gen_logger));</div>
<div class="line">        output_file &lt;&lt; <span class="stringliteral">&quot;Generate operations times (ns):&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        gen_logger-&gt;write_data(output_file);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> apply_logger = std::make_shared&lt;loggers::OperationLogger&gt;();</div>
<div class="line">        exec-&gt;add_logger(apply_logger);</div>
<div class="line">        <span class="keyword">auto</span> res_logger = std::make_shared&lt;loggers::ResidualLogger&lt;ValueType&gt;&gt;(</div>
<div class="line">            <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(A), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(b));</div>
<div class="line">        generated_solver-&gt;add_logger(res_logger);</div>
<div class="line">        generated_solver-&gt;apply(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(b), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(x));</div>
<div class="line">        exec-&gt;remove_logger(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(apply_logger));</div>
<div class="line">        output_file &lt;&lt; <span class="stringliteral">&quot;Apply operations times (ns):&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        apply_logger-&gt;write_data(output_file);</div>
<div class="line">        res_logger-&gt;write_data(output_file);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Solution, first ten entries: \n&quot;</span>;</div>
<div class="line">    print_vector(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a>(x));</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;The performance and residual data can be found in &quot;</span> &lt;&lt; of_name</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aclassgko_1_1Executor_html_a24eeee7648c0f0fd07c9866d07154875"><div class="ttname"><a href="classgko_1_1Executor.html#a24eeee7648c0f0fd07c9866d07154875">gko::Executor::synchronize</a></div><div class="ttdeci">virtual void synchronize() const =0</div><div class="ttdoc">Synchronize the operations launched on the executor with its master.</div></div>
<div class="ttc" id="aclassgko_1_1matrix_1_1Csr_html"><div class="ttname"><a href="classgko_1_1matrix_1_1Csr.html">gko::matrix::Csr</a></div><div class="ttdoc">CSR is a matrix format which stores only the nonzero coefficients by compressing each row of the matr...</div><div class="ttdef"><b>Definition:</b> matrix.hpp:54</div></div>
<div class="ttc" id="aclassgko_1_1LinOp_html"><div class="ttname"><a href="classgko_1_1LinOp.html">gko::LinOp</a></div><div class="ttdef"><b>Definition:</b> lin_op.hpp:146</div></div>
<div class="ttc" id="aclassgko_1_1matrix_1_1Dense_html"><div class="ttname"><a href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense</a></div><div class="ttdoc">Dense is a matrix format which explicitly stores all values of the matrix.</div><div class="ttdef"><b>Definition:</b> dense_cache.hpp:48</div></div>
<div class="ttc" id="aclassgko_1_1OmpExecutor_html_a33ca05fdd0fc928ee262fc9425304874"><div class="ttname"><a href="classgko_1_1OmpExecutor.html#a33ca05fdd0fc928ee262fc9425304874">gko::OmpExecutor::create</a></div><div class="ttdeci">static std::shared_ptr&lt; OmpExecutor &gt; create()</div><div class="ttdoc">Creates a new OmpExecutor.</div><div class="ttdef"><b>Definition:</b> executor.hpp:1257</div></div>
<div class="ttc" id="anamespacegko_html_a0913bfb81622f6bdde52884015c2a4ed"><div class="ttname"><a href="namespacegko.html#a0913bfb81622f6bdde52884015c2a4ed">gko::uintptr</a></div><div class="ttdeci">std::uintptr_t uintptr</div><div class="ttdoc">Unsigned integer type capable of holding a pointer to void.</div><div class="ttdef"><b>Definition:</b> types.hpp:157</div></div>
<div class="ttc" id="aclassgko_1_1matrix_1_1IdentityFactory_html"><div class="ttname"><a href="classgko_1_1matrix_1_1IdentityFactory.html">gko::matrix::IdentityFactory</a></div><div class="ttdoc">This factory is a utility which can be used to generate Identity operators.</div><div class="ttdef"><b>Definition:</b> identity.hpp:131</div></div>
<div class="ttc" id="anamespacegko_html_a6e5c95df0ae4e47aab2f604a22d98ee7"><div class="ttname"><a href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a></div><div class="ttdeci">std::size_t size_type</div><div class="ttdoc">Integral type used for allocation quantities.</div><div class="ttdef"><b>Definition:</b> types.hpp:105</div></div>
<div class="ttc" id="agroup__LinOp_html_ga2f54bac1e95fb3ef03974fa9c9088491"><div class="ttname"><a href="group__LinOp.html#ga2f54bac1e95fb3ef03974fa9c9088491">gko::initialize</a></div><div class="ttdeci">std::unique_ptr&lt; Matrix &gt; initialize(size_type stride, std::initializer_list&lt; typename Matrix::value_type &gt; vals, std::shared_ptr&lt; const Executor &gt; exec, TArgs &amp;&amp;... create_args)</div><div class="ttdoc">Creates and initializes a column-vector.</div><div class="ttdef"><b>Definition:</b> dense.hpp:1300</div></div>
<div class="ttc" id="aclassgko_1_1matrix_1_1Dense_html_af0f1af68853537807ca271a296de3cd0"><div class="ttname"><a href="classgko_1_1matrix_1_1Dense.html#af0f1af68853537807ca271a296de3cd0">gko::matrix::Dense::at</a></div><div class="ttdeci">value_type &amp; at(size_type row, size_type col) noexcept</div><div class="ttdoc">Returns a single element of the matrix.</div><div class="ttdef"><b>Definition:</b> dense.hpp:683</div></div>
<div class="ttc" id="anamespacegko_html_a1beb80750459e4201aa9d882d2d074c3"><div class="ttname"><a href="namespacegko.html#a1beb80750459e4201aa9d882d2d074c3">gko::clone</a></div><div class="ttdeci">detail::cloned_type&lt; Pointer &gt; clone(const Pointer &amp;p)</div><div class="ttdoc">Creates a unique clone of the object pointed to by p.</div><div class="ttdef"><b>Definition:</b> utils_helper.hpp:160</div></div>
<div class="ttc" id="anamespacegko_html"><div class="ttname"><a href="namespacegko.html">gko</a></div><div class="ttdoc">The Ginkgo namespace.</div><div class="ttdef"><b>Definition:</b> abstract_factory.hpp:45</div></div>
<div class="ttc" id="aclassgko_1_1version__info_html_a6daeb8a087cfb57fa055526fc133d8eb"><div class="ttname"><a href="classgko_1_1version__info.html#a6daeb8a087cfb57fa055526fc133d8eb">gko::version_info::get</a></div><div class="ttdeci">static const version_info &amp; get()</div><div class="ttdoc">Returns an instance of version_info.</div><div class="ttdef"><b>Definition:</b> version.hpp:168</div></div>
<div class="ttc" id="anamespacegko_html_a73ce7e87aec389b5210630bb617b4baa"><div class="ttname"><a href="namespacegko.html#a73ce7e87aec389b5210630bb617b4baa">gko::as</a></div><div class="ttdeci">std::decay&lt; T &gt;::type * as(U *obj)</div><div class="ttdoc">Performs polymorphic type conversion.</div><div class="ttdef"><b>Definition:</b> utils_helper.hpp:292</div></div>
<div class="ttc" id="aclassgko_1_1stop_1_1ResidualNorm_html"><div class="ttname"><a href="classgko_1_1stop_1_1ResidualNorm.html">gko::stop::ResidualNorm</a></div><div class="ttdoc">The ResidualNorm class is a stopping criterion which stops the iteration process when the actual resi...</div><div class="ttdef"><b>Definition:</b> residual_norm.hpp:137</div></div>
<div class="ttc" id="astructgko_1_1dim_html"><div class="ttname"><a href="structgko_1_1dim.html">gko::dim&lt; 2 &gt;</a></div></div>
<div class="ttc" id="astructgko_1_1matrix__data_html"><div class="ttname"><a href="structgko_1_1matrix__data.html">gko::matrix_data</a></div><div class="ttdoc">This structure is used as an intermediate data type to store a sparse matrix.</div><div class="ttdef"><b>Definition:</b> matrix_data.hpp:155</div></div>
<div class="ttc" id="aclassgko_1_1solver_1_1Cg_html"><div class="ttname"><a href="classgko_1_1solver_1_1Cg.html">gko::solver::Cg</a></div><div class="ttdoc">CG or the conjugate gradient method is an iterative type Krylov subspace method which is suitable for...</div><div class="ttdef"><b>Definition:</b> cg.hpp:74</div></div>
<div class="ttc" id="aclassgko_1_1Operation_html_ab3b940849d1daf02830f3387c52888d0"><div class="ttname"><a href="classgko_1_1Operation.html#ab3b940849d1daf02830f3387c52888d0">gko::Operation::get_name</a></div><div class="ttdeci">virtual const char * get_name() const noexcept</div><div class="ttdoc">Returns the operation's name.</div></div>
<div class="ttc" id="aclassgko_1_1CudaExecutor_html_a5dcec3ca1c458382e01191b727959a81"><div class="ttname"><a href="classgko_1_1CudaExecutor.html#a5dcec3ca1c458382e01191b727959a81">gko::CudaExecutor::create</a></div><div class="ttdeci">static std::shared_ptr&lt; CudaExecutor &gt; create(int device_id, std::shared_ptr&lt; Executor &gt; master, bool device_reset=false, allocation_mode alloc_mode=default_cuda_alloc_mode)</div><div class="ttdoc">Creates a new CudaExecutor.</div></div>
<div class="ttc" id="aclassgko_1_1log_1_1Logger_html"><div class="ttname"><a href="classgko_1_1log_1_1Logger.html">gko::log::Logger</a></div><div class="ttdef"><b>Definition:</b> logger.hpp:90</div></div>
<div class="ttc" id="anamespacegko_html_a3ce296f73db0ff398bdea6009a3a5c58"><div class="ttname"><a href="namespacegko.html#a3ce296f73db0ff398bdea6009a3a5c58">gko::share</a></div><div class="ttdeci">detail::shared_type&lt; OwningPointer &gt; share(OwningPointer &amp;&amp;p)</div><div class="ttdoc">Marks the object pointed to by p as shared.</div><div class="ttdef"><b>Definition:</b> utils_helper.hpp:211</div></div>
<div class="ttc" id="anamespacegko_html_a014ec51e675c425bb83908361f630450"><div class="ttname"><a href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a></div><div class="ttdeci">std::enable_if&lt; detail::have_ownership_s&lt; Pointer &gt;::value, detail::pointee&lt; Pointer &gt; * &gt;::type lend(const Pointer &amp;p)</div><div class="ttdoc">Returns a non-owning (plain) pointer to the object pointed to by p.</div><div class="ttdef"><b>Definition:</b> utils_helper.hpp:256</div></div>
<div class="ttc" id="aclassgko_1_1Executor_html"><div class="ttname"><a href="classgko_1_1Executor.html">gko::Executor</a></div><div class="ttdoc">The first step in using the Ginkgo library consists of creating an executor.</div><div class="ttdef"><b>Definition:</b> executor.hpp:602</div></div>
<div class="ttc" id="aclassgko_1_1HipExecutor_html_ad3a72bc42254fb8730bc2090147447d9"><div class="ttname"><a href="classgko_1_1HipExecutor.html#ad3a72bc42254fb8730bc2090147447d9">gko::HipExecutor::create</a></div><div class="ttdeci">static std::shared_ptr&lt; HipExecutor &gt; create(int device_id, std::shared_ptr&lt; Executor &gt; master, bool device_reset=false, allocation_mode alloc_mode=default_hip_alloc_mode)</div><div class="ttdoc">Creates a new HipExecutor.</div></div>
<div class="ttc" id="aclassgko_1_1PolymorphicObject_html_ab40586bff071b7f11c2cf6b5cbf598eb"><div class="ttname"><a href="classgko_1_1PolymorphicObject.html#ab40586bff071b7f11c2cf6b5cbf598eb">gko::PolymorphicObject::get_executor</a></div><div class="ttdeci">std::shared_ptr&lt; const Executor &gt; get_executor() const noexcept</div><div class="ttdoc">Returns the Executor of the object.</div><div class="ttdef"><b>Definition:</b> polymorphic_object.hpp:247</div></div>
<div class="ttc" id="aclassgko_1_1LinOp_html_a31b3c003388eb0b95393154f68c2b98d"><div class="ttname"><a href="classgko_1_1LinOp.html#a31b3c003388eb0b95393154f68c2b98d">gko::LinOp::get_size</a></div><div class="ttdeci">const dim&lt; 2 &gt; &amp; get_size() const noexcept</div><div class="ttdoc">Returns the size of the operator.</div><div class="ttdef"><b>Definition:</b> lin_op.hpp:233</div></div>
<div class="ttc" id="anamespacegko_html_afd46d554050c4ae90e84ea4fcd9a41f3"><div class="ttname"><a href="namespacegko.html#afd46d554050c4ae90e84ea4fcd9a41f3">gko::remove_complex</a></div><div class="ttdeci">typename detail::remove_complex_s&lt; T &gt;::type remove_complex</div><div class="ttdoc">Obtain the type which removed the complex of complex/scalar type or the template parameter of class b...</div><div class="ttdef"><b>Definition:</b> math.hpp:359</div></div>
<div class="ttc" id="aclassgko_1_1DpcppExecutor_html_ae9b875dfe3af7f3f3f24071bfb2f895e"><div class="ttname"><a href="classgko_1_1DpcppExecutor.html#ae9b875dfe3af7f3f3f24071bfb2f895e">gko::DpcppExecutor::create</a></div><div class="ttdeci">static std::shared_ptr&lt; DpcppExecutor &gt; create(int device_id, std::shared_ptr&lt; Executor &gt; master, std::string device_type=&quot;all&quot;, dpcpp_queue_property property=dpcpp_queue_property::in_order)</div><div class="ttdoc">Creates a new DpcppExecutor.</div></div>
<div class="ttc" id="aclassgko_1_1Operation_html"><div class="ttname"><a href="classgko_1_1Operation.html">gko::Operation</a></div><div class="ttdoc">Operations can be used to define functionalities whose implementations differ among devices.</div><div class="ttdef"><b>Definition:</b> executor.hpp:286</div></div>
<div class="ttc" id="anamespacegko_html_a0059e27f8f4bc348ff65c1e60caf47c8"><div class="ttname"><a href="namespacegko.html#a0059e27f8f4bc348ff65c1e60caf47c8">gko::one</a></div><div class="ttdeci">constexpr T one()</div><div class="ttdoc">Returns the multiplicative identity for T.</div><div class="ttdef"><b>Definition:</b> math.hpp:808</div></div>
<div class="ttc" id="aclassgko_1_1LinOp_html_a0449b2fc705d2f970855af23b5e2788e"><div class="ttname"><a href="classgko_1_1LinOp.html#a0449b2fc705d2f970855af23b5e2788e">gko::LinOp::apply</a></div><div class="ttdeci">LinOp * apply(const LinOp *b, LinOp *x)</div><div class="ttdoc">Applies a linear operator to a vector (or a sequence of vectors).</div><div class="ttdef"><b>Definition:</b> lin_op.hpp:158</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>

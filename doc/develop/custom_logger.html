<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ginkgo: The custom-logger program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_doc.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Ginkgo
   &#160;<span id="projectnumber">Generated from pipelines/1352441528 branch based on develop. Ginkgo version 1.9.0</span>
   </div>
   <div id="projectbrief">A numerical linear algebra library targeting many-core architectures</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The custom-logger program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The simple solver with a custom logger example..</p>
<p>This example depends on simple-solver, simple-solver-logging, minimal-cuda-solver.</p>
<p> 
<table class="example" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Abouttheexample"> About the example </a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Includefiles">Include files</a>
        <li><a href="#Wheredoyouwanttorunyoursolver">Where do you want to run your solver ?</a>
        <li><a href="#Readingyourdataandtransfertotheproperdevice">Reading your data and transfer to the proper device.</a>
        <li><a href="#Creatingthesolver">Creating the solver</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Commentsaboutprogramminganddebugging"> Comments about programming and debugging </a>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 <a class="anchor" id="Intro"></a> <a class="anchor" id="Introduction"></a></p><h1>Introduction</h1>
<p>The custom-logger example shows how Ginkgo's API can be leveraged to implement application-specific callbacks for Ginkgo's events. This is the most basic way of extending Ginkgo and a good first step for any application developer who wants to adapt Ginkgo to his specific needs.</p>
<p>Ginkgo's <a class="el" href="classgko_1_1log_1_1Logger.html">gko::log::Logger</a> abstraction provides hooks to the events that happen during the library execution. These hooks concern any low-level event such as memory allocations, deallocations, copies and kernel launches up to high-level events such as linear operator applications and completion of solver iterations.</p>
<p>In this example, a simple logger is implemented to track the solver's recurrent residual norm and compute the true residual norm. At the end of the solver execution, a comparison table is shown on-screen.</p>
<p><a class="anchor" id="Abouttheexample"></a></p><h3>About the example </h3>
<p>Each example has the following sections: </p><ol>
<li>
<b>Introduction:</b>This gives an overview of the example and mentions any interesting aspects in the example that might help the reader. </li>
<li>
<b>The commented program:</b> This section is intended for you to understand the details of the example so that you can play with it and understand Ginkgo and its features better. </li>
<li>
<b>Results:</b> This section shows the results of the code when run. Though the results may not be completely the same, you can expect the behaviour to be similar. </li>
<li>
<b>The plain program:</b> This is the complete code without any comments to have an complete overview of the code. </li>
</ol>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<div class="fragment"><div class="line">    <span class="keywordflow">return</span> mtx-&gt;get_executor()-&gt;copy_val_to_host(mtx-&gt;get_const_values());</div>
<div class="line">}</div>
</div><!-- fragment --><p>Utility function which computes the norm of a Ginkgo <a class="el" href="classgko_1_1matrix_1_1Dense.html" title="Dense is a matrix format which explicitly stores all values of the matrix.">gko::matrix::Dense</a> vector.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><a class="code" href="namespacegko.html#afd46d554050c4ae90e84ea4fcd9a41f3">gko::remove_complex&lt;ValueType&gt;</a> compute_norm(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;ValueType&gt;</a>* b)</div>
<div class="line">{</div>
</div><!-- fragment --><p>Get the executor of the vector</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> exec = b-&gt;<a class="code" href="classgko_1_1PolymorphicObject.html#ab40586bff071b7f11c2cf6b5cbf598eb">get_executor</a>();</div>
</div><!-- fragment --><p>Initialize a result scalar containing the value 0.0.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> b_norm =</div>
<div class="line">    gko::initialize&lt;gko::matrix::Dense&lt;gko::remove_complex&lt;ValueType&gt;&gt;&gt;(</div>
<div class="line">        {0.0}, exec);</div>
</div><!-- fragment --><p>Use the dense <code>compute_norm2</code> function to compute the norm.</p>
<div class="fragment"><div class="line">b-&gt;<a class="code" href="classgko_1_1matrix_1_1Dense.html#aed62418c4ecb58c4855b0bea1b7a680d">compute_norm2</a>(b_norm);</div>
</div><!-- fragment --><p>Use the other utility function to return the norm contained in <code>b_norm</code></p>
<div class="fragment"><div class="line">    <span class="keywordflow">return</span> get_first_element(b_norm.get());</div>
<div class="line">}</div>
</div><!-- fragment --><p>Custom logger class which intercepts the residual norm scalar and solution vector in order to print a table of real vs recurrent (internal to the solvers) residual norms.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><span class="keyword">struct </span>ResidualLogger : <a class="code" href="classgko_1_1log_1_1Logger.html">gko::log::Logger</a> {</div>
<div class="line">    <span class="keyword">using</span> RealValueType = <a class="code" href="namespacegko.html#afd46d554050c4ae90e84ea4fcd9a41f3">gko::remove_complex&lt;ValueType&gt;</a>;</div>
</div><!-- fragment --><p>Output the logger's data in a table format</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="namespacegko.html#a8c8403e4cdb91e225515ed7d7f6c4463">write</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
</div><!-- fragment --><p>Print a header for the table</p>
<div class="fragment"><div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Recurrent vs true vs implicit residual norm:&quot;</span></div>
<div class="line">          &lt;&lt; std::endl;</div>
<div class="line">std::cout &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(10) &lt;&lt; <span class="stringliteral">&quot;Iteration&quot;</span> &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(25)</div>
<div class="line">          &lt;&lt; <span class="stringliteral">&quot;Recurrent Residual Norm&quot;</span> &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(25)</div>
<div class="line">          &lt;&lt; <span class="stringliteral">&quot;True Residual Norm&quot;</span> &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(25)</div>
<div class="line">          &lt;&lt; <span class="stringliteral">&quot;Implicit Residual Norm&quot;</span> &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>Print a separation line. Note that for creating <code>10</code> characters <code>std::setw()</code> should be set to <code>11</code>.</p>
<div class="fragment"><div class="line">std::cout &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setfill(<span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::setw(11) &lt;&lt; <span class="charliteral">&#39;|&#39;</span></div>
<div class="line">          &lt;&lt; std::setw(26) &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(26) &lt;&lt; <span class="charliteral">&#39;|&#39;</span></div>
<div class="line">          &lt;&lt; std::setw(26) &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setfill(<span class="charliteral">&#39; &#39;</span>) &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>Print the data one by one in the form</p>
<div class="fragment"><div class="line">std::cout &lt;&lt; std::scientific;</div>
<div class="line"><span class="keywordflow">for</span> (std::size_t i = 0; i &lt; iterations.size(); i++) {</div>
<div class="line">    std::cout &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(10) &lt;&lt; iterations[i] &lt;&lt; <span class="charliteral">&#39;|&#39;</span></div>
<div class="line">              &lt;&lt; std::setw(25) &lt;&lt; recurrent_norms[i] &lt;&lt; <span class="charliteral">&#39;|&#39;</span></div>
<div class="line">              &lt;&lt; std::setw(25) &lt;&lt; real_norms[i] &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(25)</div>
<div class="line">              &lt;&lt; implicit_norms[i] &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>std::defaultfloat could be used here but some compilers do not support it properly, e.g. the Intel compiler</p>
<div class="fragment"><div class="line">std::cout.unsetf(std::ios_base::floatfield);</div>
</div><!-- fragment --><p>Print a separation line</p>
<div class="fragment"><div class="line">    std::cout &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setfill(<span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::setw(11) &lt;&lt; <span class="charliteral">&#39;|&#39;</span></div>
<div class="line">              &lt;&lt; std::setw(26) &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(26) &lt;&lt; <span class="charliteral">&#39;|&#39;</span></div>
<div class="line">              &lt;&lt; std::setw(26) &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setfill(<span class="charliteral">&#39; &#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> gko_dense = <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;ValueType&gt;</a>;</div>
<div class="line"><span class="keyword">using</span> gko_real_dense = <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;RealValueType&gt;</a>;</div>
</div><!-- fragment --><p>Customize the logging hook which is called everytime an iteration is completed</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> on_iteration_complete(<span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* solver, <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* b,</div>
<div class="line">                           <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* solution,</div>
<div class="line">                           <span class="keyword">const</span> <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>&amp; iteration,</div>
<div class="line">                           <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* residual,</div>
<div class="line">                           <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* residual_norm,</div>
<div class="line">                           <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* implicit_sq_residual_norm,</div>
<div class="line">                           <span class="keyword">const</span> <a class="code" href="classgko_1_1array.html">gko::array&lt;gko::stopping_status&gt;</a>*,</div>
<div class="line">                           <span class="keywordtype">bool</span>)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword"></span>{</div>
</div><!-- fragment --><p>If the solver shares a residual norm, log its value</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (residual_norm) {</div>
<div class="line">    <span class="keyword">auto</span> dense_norm = gko::as&lt;gko_real_dense&gt;(residual_norm);</div>
</div><!-- fragment --><p>Add the norm to the <code>recurrent_norms</code> vector</p>
<div class="fragment"><div class="line">recurrent_norms.push_back(get_first_element(dense_norm));</div>
</div><!-- fragment --><p>Otherwise, use the recurrent residual vector</p>
<div class="fragment"><div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keyword">auto</span> dense_residual = gko::as&lt;gko_dense&gt;(residual);</div>
</div><!-- fragment --><p>Compute the residual vector's norm</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> norm = compute_norm(dense_residual);</div>
</div><!-- fragment --><p>Add the computed norm to the <code>recurrent_norms</code> vector</p>
<div class="fragment"><div class="line">    recurrent_norms.push_back(norm);</div>
<div class="line">}</div>
</div><!-- fragment --><p>If the solver shares the current solution vector</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (solution) {</div>
</div><!-- fragment --><p>Extract the matrix from the solver</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> matrix = gko::as&lt;gko::solver::detail::SolverBaseLinOp&gt;(solver)</div>
<div class="line">                  -&gt;get_system_matrix();</div>
</div><!-- fragment --><p>Store the matrix's executor</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> exec = matrix-&gt;get_executor();</div>
</div><!-- fragment --><p>Create a scalar containing the value 1.0</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> <a class="code" href="namespacegko.html#a0059e27f8f4bc348ff65c1e60caf47c8">one</a> = gko::initialize&lt;gko_dense&gt;({1.0}, exec);</div>
</div><!-- fragment --><p>Create a scalar containing the value -1.0</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> neg_one = gko::initialize&lt;gko_dense&gt;({-1.0}, exec);</div>
</div><!-- fragment --><p>Instantiate a temporary result variable</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> res = gko::as&lt;gko_dense&gt;(<a class="code" href="namespacegko.html#a1beb80750459e4201aa9d882d2d074c3">gko::clone</a>(b));</div>
</div><!-- fragment --><p>Compute the real residual vector by calling apply on the system matrix</p>
<div class="fragment"><div class="line">matrix-&gt;apply(one, solution, neg_one, res);</div>
</div><!-- fragment --><p>Compute the norm of the residual vector and add it to the <code>real_norms</code> vector</p>
<div class="fragment"><div class="line">    real_norms.push_back(compute_norm(res.get()));</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
</div><!-- fragment --><p>Add to the <code>real_norms</code> vector the value -1.0 if it could not be computed</p>
<div class="fragment"><div class="line">    real_norms.push_back(-1.0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (implicit_sq_residual_norm) {</div>
<div class="line">    <span class="keyword">auto</span> dense_norm =</div>
<div class="line">        gko::as&lt;gko_real_dense&gt;(implicit_sq_residual_norm);</div>
</div><!-- fragment --><p>Add the norm to the <code>implicit_norms</code> vector</p>
<div class="fragment"><div class="line">    implicit_norms.push_back(std::sqrt(get_first_element(dense_norm)));</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
</div><!-- fragment --><p>Add to the <code>implicit_norms</code> vector the value -1.0 if it could not be computed</p>
<div class="fragment"><div class="line">    implicit_norms.push_back(-1.0);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Add the current iteration number to the <code>iterations</code> vector</p>
<div class="fragment"><div class="line">    iterations.push_back(iteration);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Construct the logger</p>
<div class="fragment"><div class="line">    ResidualLogger()</div>
<div class="line">        : <a class="code" href="namespacegko.html">gko</a>::log::Logger(<a class="code" href="namespacegko.html">gko</a>::log::Logger::iteration_complete_mask)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
</div><!-- fragment --><p>Vector which stores all the recurrent residual norms</p>
<div class="fragment"><div class="line"><span class="keyword">mutable</span> std::vector&lt;RealValueType&gt; recurrent_norms{};</div>
</div><!-- fragment --><p>Vector which stores all the real residual norms</p>
<div class="fragment"><div class="line"><span class="keyword">mutable</span> std::vector&lt;RealValueType&gt; real_norms{};</div>
</div><!-- fragment --><p>Vector which stores all the implicit residual norms</p>
<div class="fragment"><div class="line"><span class="keyword">mutable</span> std::vector&lt;RealValueType&gt; implicit_norms{};</div>
</div><!-- fragment --><p>Vector which stores all the iteration numbers</p>
<div class="fragment"><div class="line">    <span class="keyword">mutable</span> std::vector&lt;std::size_t&gt; iterations{};</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
</div><!-- fragment --><p>Use some shortcuts. In Ginkgo, vectors are seen as a <a class="el" href="classgko_1_1matrix_1_1Dense.html" title="Dense is a matrix format which explicitly stores all values of the matrix.">gko::matrix::Dense</a> with one column/one row. The advantage of this concept is that using multiple vectors is a now a natural extension of adding columns/rows are necessary.</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> ValueType = double;</div>
<div class="line"><span class="keyword">using</span> RealValueType = <a class="code" href="namespacegko.html#afd46d554050c4ae90e84ea4fcd9a41f3">gko::remove_complex&lt;ValueType&gt;</a>;</div>
<div class="line"><span class="keyword">using</span> IndexType = int;</div>
<div class="line"><span class="keyword">using</span> vec = <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;ValueType&gt;</a>;</div>
<div class="line"><span class="keyword">using</span> real_vec = <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;RealValueType&gt;</a>;</div>
</div><!-- fragment --><p>The <a class="el" href="classgko_1_1matrix_1_1Csr.html" title="CSR is a matrix format which stores only the nonzero coefficients by compressing each row of the matr...">gko::matrix::Csr</a> class is used here, but any other matrix class such as <a class="el" href="classgko_1_1matrix_1_1Coo.html" title="COO stores a matrix in the coordinate matrix format.">gko::matrix::Coo</a>, <a class="el" href="classgko_1_1matrix_1_1Hybrid.html" title="HYBRID is a matrix format which splits the matrix into ELLPACK and COO format.">gko::matrix::Hybrid</a>, <a class="el" href="classgko_1_1matrix_1_1Ell.html" title="ELL is a matrix format where stride with explicit zeros is used such that all rows have the same numb...">gko::matrix::Ell</a> or <a class="el" href="classgko_1_1matrix_1_1Sellp.html" title="SELL-P is a matrix format similar to ELL format.">gko::matrix::Sellp</a> could also be used.</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> mtx = <a class="code" href="classgko_1_1matrix_1_1Csr.html">gko::matrix::Csr&lt;ValueType, IndexType&gt;</a>;</div>
</div><!-- fragment --><p>The <a class="el" href="classgko_1_1solver_1_1Cg.html" title="CG or the conjugate gradient method is an iterative type Krylov subspace method which is suitable for...">gko::solver::Cg</a> is used here, but any other solver class can also be used.</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> cg = <a class="code" href="classgko_1_1solver_1_1Cg.html">gko::solver::Cg&lt;ValueType&gt;</a>;</div>
</div><!-- fragment --><p>Print the ginkgo version information.</p>
<div class="fragment"><div class="line">std::cout &lt;&lt; <a class="code" href="classgko_1_1version__info.html#a6daeb8a087cfb57fa055526fc133d8eb">gko::version_info::get</a>() &lt;&lt; std::endl;</div>
</div><!-- fragment --><p><a class="anchor" id="Wheredoyouwanttorunyoursolver"></a> </p><h3>Where do you want to run your solver ?</h3>
<p>The <a class="el" href="classgko_1_1Executor.html" title="The first step in using the Ginkgo library consists of creating an executor.">gko::Executor</a> class is one of the cornerstones of Ginkgo. Currently, we have support for an <a class="el" href="classgko_1_1OmpExecutor.html" title="This is the Executor subclass which represents the OpenMP device (typically CPU).">gko::OmpExecutor</a>, which uses OpenMP multi-threading in most of its kernels, a <a class="el" href="classgko_1_1ReferenceExecutor.html" title="This is a specialization of the OmpExecutor, which runs the reference implementations of the kernels ...">gko::ReferenceExecutor</a>, a single threaded specialization of the OpenMP executor and a <a class="el" href="classgko_1_1CudaExecutor.html" title="This is the Executor subclass which represents the CUDA device.">gko::CudaExecutor</a> which runs the code on a NVIDIA GPU if available. </p><dl class="section note"><dt>Note</dt><dd>With the help of C++, you see that you only ever need to change the executor and all the other functions/ routines within Ginkgo should automatically work and run on the executor with any other changes.</dd></dl>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (argc == 2 &amp;&amp; (std::string(argv[1]) == <span class="stringliteral">&quot;--help&quot;</span>)) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; [executor]&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::exit(-1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> executor_string = argc &gt;= 2 ? argv[1] : <span class="stringliteral">&quot;reference&quot;</span>;</div>
</div><!-- fragment --><p>Figure out where to run the code</p>
<div class="fragment"><div class="line">std::map&lt;std::string, std::function&lt;std::shared_ptr&lt;gko::Executor&gt;()&gt;&gt;</div>
<div class="line">    exec_map{</div>
<div class="line">        {<span class="stringliteral">&quot;omp&quot;</span>, [] { <span class="keywordflow">return</span> <a class="code" href="classgko_1_1OmpExecutor.html#a8930142a1913bcbcac4fb6c917f930d9">gko::OmpExecutor::create</a>(); }},</div>
<div class="line">        {<span class="stringliteral">&quot;cuda&quot;</span>,</div>
<div class="line">         [] {</div>
<div class="line">             <span class="keywordflow">return</span> <a class="code" href="classgko_1_1CudaExecutor.html#a6c423656c7c0eb53810cb77bb4a66d15">gko::CudaExecutor::create</a>(0,</div>
<div class="line">                                              <a class="code" href="classgko_1_1OmpExecutor.html#a8930142a1913bcbcac4fb6c917f930d9">gko::OmpExecutor::create</a>());</div>
<div class="line">         }},</div>
<div class="line">        {<span class="stringliteral">&quot;hip&quot;</span>,</div>
<div class="line">         [] {</div>
<div class="line">             <span class="keywordflow">return</span> <a class="code" href="classgko_1_1HipExecutor.html#aa0701fe1303e03a8331da7e95008100d">gko::HipExecutor::create</a>(0, <a class="code" href="classgko_1_1OmpExecutor.html#a8930142a1913bcbcac4fb6c917f930d9">gko::OmpExecutor::create</a>());</div>
<div class="line">         }},</div>
<div class="line">        {<span class="stringliteral">&quot;dpcpp&quot;</span>,</div>
<div class="line">         [] {</div>
<div class="line">             <span class="keywordflow">return</span> <a class="code" href="classgko_1_1DpcppExecutor.html#ae9b875dfe3af7f3f3f24071bfb2f895e">gko::DpcppExecutor::create</a>(0,</div>
<div class="line">                                               <a class="code" href="classgko_1_1OmpExecutor.html#a8930142a1913bcbcac4fb6c917f930d9">gko::OmpExecutor::create</a>());</div>
<div class="line">         }},</div>
<div class="line">        {<span class="stringliteral">&quot;reference&quot;</span>, [] { <span class="keywordflow">return</span> gko::ReferenceExecutor::create(); }}};</div>
</div><!-- fragment --><p>executor where Ginkgo will perform the computation</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> exec = exec_map.at(executor_string)();  <span class="comment">// throws if not valid</span></div>
</div><!-- fragment --><p><a class="anchor" id="Readingyourdataandtransfertotheproperdevice"></a> </p><h3>Reading your data and transfer to the proper device.</h3>
<p>Read the matrix, right hand side and the initial solution using the read function. </p><dl class="section note"><dt>Note</dt><dd>Ginkgo uses C++ smart pointers to automatically manage memory. To this end, we use our own object ownership transfer functions that under the hood call the required smart pointer functions to manage object ownership. <a class="el" href="namespacegko.html#a3ce296f73db0ff398bdea6009a3a5c58" title="Marks the object pointed to by p as shared.">gko::share</a> and <a class="el" href="namespacegko.html#acbd3fd6d07e498892881e8e2ab0b4167" title="Marks that the object pointed to by p can be given to the callee.">gko::give</a> are the functions that you would need to use.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">auto</span> A = <a class="code" href="namespacegko.html#a3ce296f73db0ff398bdea6009a3a5c58">share</a>(gko::read&lt;mtx&gt;(std::ifstream(<span class="stringliteral">&quot;data/A.mtx&quot;</span>), exec));</div>
<div class="line"><span class="keyword">auto</span> b = gko::read&lt;vec&gt;(std::ifstream(<span class="stringliteral">&quot;data/b.mtx&quot;</span>), exec);</div>
<div class="line"><span class="keyword">auto</span> x = gko::read&lt;vec&gt;(std::ifstream(<span class="stringliteral">&quot;data/x0.mtx&quot;</span>), exec);</div>
<div class="line"><span class="keyword">const</span> RealValueType reduction_factor = 1e-7;</div>
</div><!-- fragment --><p><a class="anchor" id="Creatingthesolver"></a> </p><h3>Creating the solver</h3>
<p>Generate the <a class="el" href="namespacegko_1_1solver.html" title="The ginkgo Solve namespace.">gko::solver</a> factory. Ginkgo uses the concept of Factories to build solvers with certain properties. Observe the Fluent interface used here. Here a cg solver is generated with a stopping criteria of maximum iterations of 20 and a residual norm reduction of 1e-15. You also observe that the stopping criteria(gko::stop) are also generated from factories using their build methods. You need to specify the executors which each of the object needs to be built on.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> solver_gen =</div>
<div class="line">    cg::build()</div>
<div class="line">        .with_criteria(gko::stop::Iteration::build().with_max_iters(20u),</div>
<div class="line">                       <a class="code" href="classgko_1_1stop_1_1ResidualNorm.html">gko::stop::ResidualNorm&lt;ValueType&gt;::build</a>()</div>
<div class="line">                           .with_reduction_factor(reduction_factor))</div>
<div class="line">        .on(exec);</div>
</div><!-- fragment --><p>Instantiate a ResidualLogger logger.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> logger = std::make_shared&lt;ResidualLogger&lt;ValueType&gt;&gt;();</div>
</div><!-- fragment --><p>Add the previously created logger to the solver factory. The logger will be automatically propagated to all solvers created from this factory.</p>
<div class="fragment"><div class="line">solver_gen-&gt;add_logger(logger);</div>
</div><!-- fragment --><p>Generate the solver from the matrix. The solver factory built in the previous step takes a "matrix"(a <a class="el" href="classgko_1_1LinOp.html">gko::LinOp</a> to be more general) as an input. In this case we provide it with a full matrix that we previously read, but as the solver only effectively uses the apply() method within the provided "matrix" object, you can effectively create a <a class="el" href="classgko_1_1LinOp.html">gko::LinOp</a> class with your own apply implementation to accomplish more tasks. We will see an example of how this can be done in the custom-matrix-format example</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> <a class="code" href="namespacegko_1_1log.html#a15f71654c6c4f4defc95f9359343fa27a7cbf673200498a0d1324f4330825202a">solver</a> = solver_gen-&gt;generate(A);</div>
</div><!-- fragment --><p>Finally, solve the system. The solver, being a <a class="el" href="classgko_1_1LinOp.html">gko::LinOp</a>, can be applied to a right hand side, b to obtain the solution, x.</p>
<div class="fragment"><div class="line"><a class="code" href="namespacegko_1_1log.html#a15f71654c6c4f4defc95f9359343fa27a7cbf673200498a0d1324f4330825202a">solver</a>-&gt;apply(b, x);</div>
</div><!-- fragment --><p>Print the solution to the command line.</p>
<div class="fragment"><div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Solution (x):\n&quot;</span>;</div>
<div class="line"><a class="code" href="namespacegko.html#a8c8403e4cdb91e225515ed7d7f6c4463">write</a>(std::cout, x);</div>
</div><!-- fragment --><p>Print the table of the residuals obtained from the logger</p>
<div class="fragment"><div class="line">logger-&gt;write();</div>
</div><!-- fragment --><p>To measure if your solution has actually converged, you can measure the error of the solution. one, neg_one are objects that represent the numbers which allow for a uniform interface when computing on any device. To compute the residual, all you need to do is call the apply method, which in this case is an spmv and equivalent to the LAPACK z_spmv routine. Finally, you compute the euclidean 2-norm with the compute_norm2 function.</p>
<div class="fragment"><div class="line">    <span class="keyword">auto</span> <a class="code" href="namespacegko.html#a0059e27f8f4bc348ff65c1e60caf47c8">one</a> = gko::initialize&lt;vec&gt;({1.0}, exec);</div>
<div class="line">    <span class="keyword">auto</span> neg_one = gko::initialize&lt;vec&gt;({-1.0}, exec);</div>
<div class="line">    <span class="keyword">auto</span> res = gko::initialize&lt;real_vec&gt;({0.0}, exec);</div>
<div class="line">    A-&gt;apply(one, x, neg_one, b);</div>
<div class="line">    b-&gt;compute_norm2(res);</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Residual norm sqrt(r^T r):\n&quot;</span>;</div>
<div class="line">    <a class="code" href="namespacegko.html#a8c8403e4cdb91e225515ed7d7f6c4463">write</a>(std::cout, res);</div>
<div class="line">}</div>
</div><!-- fragment --><p> <a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>The following is the expected result:</p>
<div class="fragment"><div class="line">Solution (x):</div>
<div class="line">%%MatrixMarket matrix <a class="code" href="namespacegko.html#ae749a5ea11a93c1bcc9158d9a6e9fb68af1f713c9e000f5d3f280adbd124df4f5">array</a> <a class="code" href="namespacegko.html#af21648097306adbabc6234b4609ce297">real</a> general</div>
<div class="line">19 1</div>
<div class="line">0.252218</div>
<div class="line">0.108645</div>
<div class="line">0.0662811</div>
<div class="line">0.0630433</div>
<div class="line">0.0384088</div>
<div class="line">0.0396536</div>
<div class="line">0.0402648</div>
<div class="line">0.0338935</div>
<div class="line">0.0193098</div>
<div class="line">0.0234653</div>
<div class="line">0.0211499</div>
<div class="line">0.0196413</div>
<div class="line">0.0199151</div>
<div class="line">0.0181674</div>
<div class="line">0.0162722</div>
<div class="line">0.0150714</div>
<div class="line">0.0107016</div>
<div class="line">0.0121141</div>
<div class="line">0.0123025</div>
<div class="line">Recurrent vs true vs implicit residual norm:</div>
<div class="line">| Iteration|  Recurrent Residual Norm|       True Residual Norm|   Implicit Residual Norm|</div>
<div class="line">|----------|-------------------------|-------------------------|-------------------------|</div>
<div class="line">|         0|             4.358899e+00|             4.358899e+00|             4.358899e+00|</div>
<div class="line">|         1|             2.304548e+00|             2.304548e+00|             2.304548e+00|</div>
<div class="line">|         2|             1.467706e+00|             1.467706e+00|             1.467706e+00|</div>
<div class="line">|         3|             9.848751e-01|             9.848751e-01|             9.848751e-01|</div>
<div class="line">|         4|             7.418330e-01|             7.418330e-01|             7.418330e-01|</div>
<div class="line">|         5|             5.136231e-01|             5.136231e-01|             5.136231e-01|</div>
<div class="line">|         6|             3.841650e-01|             3.841650e-01|             3.841650e-01|</div>
<div class="line">|         7|             3.164394e-01|             3.164394e-01|             3.164394e-01|</div>
<div class="line">|         8|             2.277088e-01|             2.277088e-01|             2.277088e-01|</div>
<div class="line">|         9|             1.703121e-01|             1.703121e-01|             1.703121e-01|</div>
<div class="line">|        10|             9.737220e-02|             9.737220e-02|             9.737220e-02|</div>
<div class="line">|        11|             6.168306e-02|             6.168306e-02|             6.168306e-02|</div>
<div class="line">|        12|             4.541231e-02|             4.541231e-02|             4.541231e-02|</div>
<div class="line">|        13|             3.195304e-02|             3.195304e-02|             3.195304e-02|</div>
<div class="line">|        14|             1.616058e-02|             1.616058e-02|             1.616058e-02|</div>
<div class="line">|        15|             6.570152e-03|             6.570152e-03|             6.570152e-03|</div>
<div class="line">|        16|             2.643669e-03|             2.643669e-03|             2.643669e-03|</div>
<div class="line">|        17|             8.588089e-04|             8.588089e-04|             8.588089e-04|</div>
<div class="line">|        18|             2.864613e-04|             2.864613e-04|             2.864613e-04|</div>
<div class="line">|        19|             1.641952e-15|             2.107881e-15|             1.641952e-15|</div>
<div class="line">|----------|-------------------------|-------------------------|-------------------------|</div>
<div class="line">Residual norm sqrt(r^T r):</div>
<div class="line">%%MatrixMarket matrix <a class="code" href="namespacegko.html#ae749a5ea11a93c1bcc9158d9a6e9fb68af1f713c9e000f5d3f280adbd124df4f5">array</a> <a class="code" href="namespacegko.html#af21648097306adbabc6234b4609ce297">real</a> general</div>
<div class="line">1 1</div>
<div class="line">2.10788e-15</div>
</div><!-- fragment --><p><a class="anchor" id="Commentsaboutprogramminganddebugging"></a></p><h3>Comments about programming and debugging </h3>
<p><a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;ginkgo/ginkgo.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ios&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line">ValueType get_first_element(<span class="keyword">const</span> <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;ValueType&gt;</a>* mtx)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> mtx-&gt;<a class="code" href="classgko_1_1PolymorphicObject.html#ab40586bff071b7f11c2cf6b5cbf598eb">get_executor</a>()-&gt;copy_val_to_host(mtx-&gt;<a class="code" href="classgko_1_1matrix_1_1Dense.html#ab83c739c1b11abaecc3bfd89506f6c9c">get_const_values</a>());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><a class="code" href="namespacegko.html#afd46d554050c4ae90e84ea4fcd9a41f3">gko::remove_complex&lt;ValueType&gt;</a> compute_norm(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;ValueType&gt;</a>* b)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> exec = b-&gt;<a class="code" href="classgko_1_1PolymorphicObject.html#ab40586bff071b7f11c2cf6b5cbf598eb">get_executor</a>();</div>
<div class="line">    <span class="keyword">auto</span> b_norm =</div>
<div class="line">        gko::initialize&lt;gko::matrix::Dense&lt;gko::remove_complex&lt;ValueType&gt;&gt;&gt;(</div>
<div class="line">            {0.0}, exec);</div>
<div class="line">    b-&gt;<a class="code" href="classgko_1_1matrix_1_1Dense.html#aed62418c4ecb58c4855b0bea1b7a680d">compute_norm2</a>(b_norm);</div>
<div class="line">    <span class="keywordflow">return</span> get_first_element(b_norm.get());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><span class="keyword">struct </span>ResidualLogger : <a class="code" href="classgko_1_1log_1_1Logger.html">gko::log::Logger</a> {</div>
<div class="line">    <span class="keyword">using</span> RealValueType = <a class="code" href="namespacegko.html#afd46d554050c4ae90e84ea4fcd9a41f3">gko::remove_complex&lt;ValueType&gt;</a>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespacegko.html#a8c8403e4cdb91e225515ed7d7f6c4463">write</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Recurrent vs true vs implicit residual norm:&quot;</span></div>
<div class="line">                  &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(10) &lt;&lt; <span class="stringliteral">&quot;Iteration&quot;</span> &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(25)</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;Recurrent Residual Norm&quot;</span> &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(25)</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;True Residual Norm&quot;</span> &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(25)</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;Implicit Residual Norm&quot;</span> &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setfill(<span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::setw(11) &lt;&lt; <span class="charliteral">&#39;|&#39;</span></div>
<div class="line">                  &lt;&lt; std::setw(26) &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(26) &lt;&lt; <span class="charliteral">&#39;|&#39;</span></div>
<div class="line">                  &lt;&lt; std::setw(26) &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setfill(<span class="charliteral">&#39; &#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; std::scientific;</div>
<div class="line">        <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; iterations.size(); i++) {</div>
<div class="line">            std::cout &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(10) &lt;&lt; iterations[i] &lt;&lt; <span class="charliteral">&#39;|&#39;</span></div>
<div class="line">                      &lt;&lt; std::setw(25) &lt;&lt; recurrent_norms[i] &lt;&lt; <span class="charliteral">&#39;|&#39;</span></div>
<div class="line">                      &lt;&lt; std::setw(25) &lt;&lt; real_norms[i] &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(25)</div>
<div class="line">                      &lt;&lt; implicit_norms[i] &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">        std::cout.unsetf(std::ios_base::floatfield);</div>
<div class="line">        std::cout &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setfill(<span class="charliteral">&#39;-&#39;</span>) &lt;&lt; std::setw(11) &lt;&lt; <span class="charliteral">&#39;|&#39;</span></div>
<div class="line">                  &lt;&lt; std::setw(26) &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setw(26) &lt;&lt; <span class="charliteral">&#39;|&#39;</span></div>
<div class="line">                  &lt;&lt; std::setw(26) &lt;&lt; <span class="charliteral">&#39;|&#39;</span> &lt;&lt; std::setfill(<span class="charliteral">&#39; &#39;</span>) &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> gko_dense = <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;ValueType&gt;</a>;</div>
<div class="line">    <span class="keyword">using</span> gko_real_dense = <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;RealValueType&gt;</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_iteration_complete(<span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* solver, <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* b,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* solution,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a>&amp; iteration,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* residual,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* residual_norm,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="classgko_1_1LinOp.html">gko::LinOp</a>* implicit_sq_residual_norm,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="classgko_1_1array.html">gko::array&lt;gko::stopping_status&gt;</a>*,</div>
<div class="line">                               <span class="keywordtype">bool</span>)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">if</span> (residual_norm) {</div>
<div class="line">            <span class="keyword">auto</span> dense_norm = gko::as&lt;gko_real_dense&gt;(residual_norm);</div>
<div class="line">            recurrent_norms.push_back(get_first_element(dense_norm));</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keyword">auto</span> dense_residual = gko::as&lt;gko_dense&gt;(residual);</div>
<div class="line">            <span class="keyword">auto</span> norm = compute_norm(dense_residual);</div>
<div class="line">            recurrent_norms.push_back(norm);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (solution) {</div>
<div class="line">            <span class="keyword">auto</span> matrix = gko::as&lt;gko::solver::detail::SolverBaseLinOp&gt;(solver)</div>
<div class="line">                              -&gt;get_system_matrix();</div>
<div class="line">            <span class="keyword">auto</span> exec = matrix-&gt;get_executor();</div>
<div class="line">            <span class="keyword">auto</span> <a class="code" href="namespacegko.html#a0059e27f8f4bc348ff65c1e60caf47c8">one</a> = gko::initialize&lt;gko_dense&gt;({1.0}, exec);</div>
<div class="line">            <span class="keyword">auto</span> neg_one = gko::initialize&lt;gko_dense&gt;({-1.0}, exec);</div>
<div class="line">            <span class="keyword">auto</span> res = gko::as&lt;gko_dense&gt;(<a class="code" href="namespacegko.html#a1beb80750459e4201aa9d882d2d074c3">gko::clone</a>(b));</div>
<div class="line">            matrix-&gt;apply(one, solution, neg_one, res);</div>
<div class="line"> </div>
<div class="line">            real_norms.push_back(compute_norm(res.get()));</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            real_norms.push_back(-1.0);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (implicit_sq_residual_norm) {</div>
<div class="line">            <span class="keyword">auto</span> dense_norm =</div>
<div class="line">                gko::as&lt;gko_real_dense&gt;(implicit_sq_residual_norm);</div>
<div class="line">            implicit_norms.push_back(std::sqrt(get_first_element(dense_norm)));</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            implicit_norms.push_back(-1.0);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        iterations.push_back(iteration);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ResidualLogger()</div>
<div class="line">        : <a class="code" href="namespacegko.html">gko</a>::log::Logger(<a class="code" href="namespacegko.html">gko</a>::log::Logger::iteration_complete_mask)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">mutable</span> std::vector&lt;RealValueType&gt; recurrent_norms{};</div>
<div class="line">    <span class="keyword">mutable</span> std::vector&lt;RealValueType&gt; real_norms{};</div>
<div class="line">    <span class="keyword">mutable</span> std::vector&lt;RealValueType&gt; implicit_norms{};</div>
<div class="line">    <span class="keyword">mutable</span> std::vector&lt;std::size_t&gt; iterations{};</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using</span> ValueType = double;</div>
<div class="line">    <span class="keyword">using</span> RealValueType = <a class="code" href="namespacegko.html#afd46d554050c4ae90e84ea4fcd9a41f3">gko::remove_complex&lt;ValueType&gt;</a>;</div>
<div class="line">    <span class="keyword">using</span> IndexType = int;</div>
<div class="line">    <span class="keyword">using</span> vec = <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;ValueType&gt;</a>;</div>
<div class="line">    <span class="keyword">using</span> real_vec = <a class="code" href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense&lt;RealValueType&gt;</a>;</div>
<div class="line">    <span class="keyword">using</span> mtx = <a class="code" href="classgko_1_1matrix_1_1Csr.html">gko::matrix::Csr&lt;ValueType, IndexType&gt;</a>;</div>
<div class="line">    <span class="keyword">using</span> cg = <a class="code" href="classgko_1_1solver_1_1Cg.html">gko::solver::Cg&lt;ValueType&gt;</a>;</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <a class="code" href="classgko_1_1version__info.html#a6daeb8a087cfb57fa055526fc133d8eb">gko::version_info::get</a>() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (argc == 2 &amp;&amp; (std::string(argv[1]) == <span class="stringliteral">&quot;--help&quot;</span>)) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; [executor]&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        std::exit(-1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> executor_string = argc &gt;= 2 ? argv[1] : <span class="stringliteral">&quot;reference&quot;</span>;</div>
<div class="line">    std::map&lt;std::string, std::function&lt;std::shared_ptr&lt;gko::Executor&gt;()&gt;&gt;</div>
<div class="line">        exec_map{</div>
<div class="line">            {<span class="stringliteral">&quot;omp&quot;</span>, [] { <span class="keywordflow">return</span> <a class="code" href="classgko_1_1OmpExecutor.html#a8930142a1913bcbcac4fb6c917f930d9">gko::OmpExecutor::create</a>(); }},</div>
<div class="line">            {<span class="stringliteral">&quot;cuda&quot;</span>,</div>
<div class="line">             [] {</div>
<div class="line">                 <span class="keywordflow">return</span> <a class="code" href="classgko_1_1CudaExecutor.html#a6c423656c7c0eb53810cb77bb4a66d15">gko::CudaExecutor::create</a>(0,</div>
<div class="line">                                                  <a class="code" href="classgko_1_1OmpExecutor.html#a8930142a1913bcbcac4fb6c917f930d9">gko::OmpExecutor::create</a>());</div>
<div class="line">             }},</div>
<div class="line">            {<span class="stringliteral">&quot;hip&quot;</span>,</div>
<div class="line">             [] {</div>
<div class="line">                 <span class="keywordflow">return</span> <a class="code" href="classgko_1_1HipExecutor.html#aa0701fe1303e03a8331da7e95008100d">gko::HipExecutor::create</a>(0, <a class="code" href="classgko_1_1OmpExecutor.html#a8930142a1913bcbcac4fb6c917f930d9">gko::OmpExecutor::create</a>());</div>
<div class="line">             }},</div>
<div class="line">            {<span class="stringliteral">&quot;dpcpp&quot;</span>,</div>
<div class="line">             [] {</div>
<div class="line">                 <span class="keywordflow">return</span> <a class="code" href="classgko_1_1DpcppExecutor.html#ae9b875dfe3af7f3f3f24071bfb2f895e">gko::DpcppExecutor::create</a>(0,</div>
<div class="line">                                                   <a class="code" href="classgko_1_1OmpExecutor.html#a8930142a1913bcbcac4fb6c917f930d9">gko::OmpExecutor::create</a>());</div>
<div class="line">             }},</div>
<div class="line">            {<span class="stringliteral">&quot;reference&quot;</span>, [] { <span class="keywordflow">return</span> gko::ReferenceExecutor::create(); }}};</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> exec = exec_map.at(executor_string)();  <span class="comment">// throws if not valid</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> A = <a class="code" href="namespacegko.html#a3ce296f73db0ff398bdea6009a3a5c58">share</a>(gko::read&lt;mtx&gt;(std::ifstream(<span class="stringliteral">&quot;data/A.mtx&quot;</span>), exec));</div>
<div class="line">    <span class="keyword">auto</span> b = gko::read&lt;vec&gt;(std::ifstream(<span class="stringliteral">&quot;data/b.mtx&quot;</span>), exec);</div>
<div class="line">    <span class="keyword">auto</span> x = gko::read&lt;vec&gt;(std::ifstream(<span class="stringliteral">&quot;data/x0.mtx&quot;</span>), exec);</div>
<div class="line">    <span class="keyword">const</span> RealValueType reduction_factor = 1e-7;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> solver_gen =</div>
<div class="line">        cg::build()</div>
<div class="line">            .with_criteria(gko::stop::Iteration::build().with_max_iters(20u),</div>
<div class="line">                           <a class="code" href="classgko_1_1stop_1_1ResidualNorm.html">gko::stop::ResidualNorm&lt;ValueType&gt;::build</a>()</div>
<div class="line">                               .with_reduction_factor(reduction_factor))</div>
<div class="line">            .on(exec);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> logger = std::make_shared&lt;ResidualLogger&lt;ValueType&gt;&gt;();</div>
<div class="line"> </div>
<div class="line">    solver_gen-&gt;add_logger(logger);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> <a class="code" href="namespacegko_1_1log.html#a15f71654c6c4f4defc95f9359343fa27a7cbf673200498a0d1324f4330825202a">solver</a> = solver_gen-&gt;generate(A);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespacegko_1_1log.html#a15f71654c6c4f4defc95f9359343fa27a7cbf673200498a0d1324f4330825202a">solver</a>-&gt;apply(b, x);</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Solution (x):\n&quot;</span>;</div>
<div class="line">    <a class="code" href="namespacegko.html#a8c8403e4cdb91e225515ed7d7f6c4463">write</a>(std::cout, x);</div>
<div class="line"> </div>
<div class="line">    logger-&gt;write();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> <a class="code" href="namespacegko.html#a0059e27f8f4bc348ff65c1e60caf47c8">one</a> = gko::initialize&lt;vec&gt;({1.0}, exec);</div>
<div class="line">    <span class="keyword">auto</span> neg_one = gko::initialize&lt;vec&gt;({-1.0}, exec);</div>
<div class="line">    <span class="keyword">auto</span> res = gko::initialize&lt;real_vec&gt;({0.0}, exec);</div>
<div class="line">    A-&gt;apply(one, x, neg_one, b);</div>
<div class="line">    b-&gt;compute_norm2(res);</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Residual norm sqrt(r^T r):\n&quot;</span>;</div>
<div class="line">    <a class="code" href="namespacegko.html#a8c8403e4cdb91e225515ed7d7f6c4463">write</a>(std::cout, res);</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aclassgko_1_1matrix_1_1Csr_html"><div class="ttname"><a href="classgko_1_1matrix_1_1Csr.html">gko::matrix::Csr</a></div><div class="ttdoc">CSR is a matrix format which stores only the nonzero coefficients by compressing each row of the matr...</div><div class="ttdef"><b>Definition:</b> matrix.hpp:27</div></div>
<div class="ttc" id="anamespacegko_1_1log_html_a15f71654c6c4f4defc95f9359343fa27a7cbf673200498a0d1324f4330825202a"><div class="ttname"><a href="namespacegko_1_1log.html#a15f71654c6c4f4defc95f9359343fa27a7cbf673200498a0d1324f4330825202a">gko::log::profile_event_category::solver</a></div><div class="ttdoc">Solver events.</div></div>
<div class="ttc" id="anamespacegko_html_ae749a5ea11a93c1bcc9158d9a6e9fb68af1f713c9e000f5d3f280adbd124df4f5"><div class="ttname"><a href="namespacegko.html#ae749a5ea11a93c1bcc9158d9a6e9fb68af1f713c9e000f5d3f280adbd124df4f5">gko::layout_type::array</a></div><div class="ttdoc">The matrix should be written as dense matrix in column-major order.</div></div>
<div class="ttc" id="aclassgko_1_1LinOp_html"><div class="ttname"><a href="classgko_1_1LinOp.html">gko::LinOp</a></div><div class="ttdef"><b>Definition:</b> lin_op.hpp:117</div></div>
<div class="ttc" id="aclassgko_1_1matrix_1_1Dense_html"><div class="ttname"><a href="classgko_1_1matrix_1_1Dense.html">gko::matrix::Dense</a></div><div class="ttdoc">Dense is a matrix format which explicitly stores all values of the matrix.</div><div class="ttdef"><b>Definition:</b> dense_cache.hpp:19</div></div>
<div class="ttc" id="anamespacegko_html_a6e5c95df0ae4e47aab2f604a22d98ee7"><div class="ttname"><a href="namespacegko.html#a6e5c95df0ae4e47aab2f604a22d98ee7">gko::size_type</a></div><div class="ttdeci">std::size_t size_type</div><div class="ttdoc">Integral type used for allocation quantities.</div><div class="ttdef"><b>Definition:</b> types.hpp:108</div></div>
<div class="ttc" id="anamespacegko_html_a1beb80750459e4201aa9d882d2d074c3"><div class="ttname"><a href="namespacegko.html#a1beb80750459e4201aa9d882d2d074c3">gko::clone</a></div><div class="ttdeci">detail::cloned_type&lt; Pointer &gt; clone(const Pointer &amp;p)</div><div class="ttdoc">Creates a unique clone of the object pointed to by p.</div><div class="ttdef"><b>Definition:</b> utils_helper.hpp:174</div></div>
<div class="ttc" id="aclassgko_1_1HipExecutor_html_aa0701fe1303e03a8331da7e95008100d"><div class="ttname"><a href="classgko_1_1HipExecutor.html#aa0701fe1303e03a8331da7e95008100d">gko::HipExecutor::create</a></div><div class="ttdeci">static std::shared_ptr&lt; HipExecutor &gt; create(int device_id, std::shared_ptr&lt; Executor &gt; master, bool device_reset, allocation_mode alloc_mode=default_hip_alloc_mode, CUstream_st *stream=nullptr)</div><div class="ttdoc">Creates a new HipExecutor.</div></div>
<div class="ttc" id="anamespacegko_html"><div class="ttname"><a href="namespacegko.html">gko</a></div><div class="ttdoc">The Ginkgo namespace.</div><div class="ttdef"><b>Definition:</b> abstract_factory.hpp:19</div></div>
<div class="ttc" id="aclassgko_1_1version__info_html_a6daeb8a087cfb57fa055526fc133d8eb"><div class="ttname"><a href="classgko_1_1version__info.html#a6daeb8a087cfb57fa055526fc133d8eb">gko::version_info::get</a></div><div class="ttdeci">static const version_info &amp; get()</div><div class="ttdoc">Returns an instance of version_info.</div><div class="ttdef"><b>Definition:</b> version.hpp:139</div></div>
<div class="ttc" id="aclassgko_1_1array_html"><div class="ttname"><a href="classgko_1_1array.html">gko::array&lt; gko::stopping_status &gt;</a></div></div>
<div class="ttc" id="aclassgko_1_1stop_1_1ResidualNorm_html"><div class="ttname"><a href="classgko_1_1stop_1_1ResidualNorm.html">gko::stop::ResidualNorm</a></div><div class="ttdoc">The ResidualNorm class is a stopping criterion which stops the iteration process when the actual resi...</div><div class="ttdef"><b>Definition:</b> residual_norm.hpp:109</div></div>
<div class="ttc" id="aclassgko_1_1matrix_1_1Dense_html_aed62418c4ecb58c4855b0bea1b7a680d"><div class="ttname"><a href="classgko_1_1matrix_1_1Dense.html#aed62418c4ecb58c4855b0bea1b7a680d">gko::matrix::Dense::compute_norm2</a></div><div class="ttdeci">void compute_norm2(ptr_param&lt; LinOp &gt; result) const</div><div class="ttdoc">Computes the column-wise Euclidean (L^2) norm of this matrix.</div></div>
<div class="ttc" id="aclassgko_1_1solver_1_1Cg_html"><div class="ttname"><a href="classgko_1_1solver_1_1Cg.html">gko::solver::Cg</a></div><div class="ttdoc">CG or the conjugate gradient method is an iterative type Krylov subspace method which is suitable for...</div><div class="ttdef"><b>Definition:</b> cg.hpp:48</div></div>
<div class="ttc" id="anamespacegko_html_a8c8403e4cdb91e225515ed7d7f6c4463"><div class="ttname"><a href="namespacegko.html#a8c8403e4cdb91e225515ed7d7f6c4463">gko::write</a></div><div class="ttdeci">void write(StreamType &amp;&amp;os, MatrixPtrType &amp;&amp;matrix, layout_type layout=detail::mtx_io_traits&lt; std::remove_cv_t&lt; detail::pointee&lt; MatrixPtrType &gt;&gt;&gt;::default_layout)</div><div class="ttdoc">Writes a matrix into an output stream in matrix market format.</div><div class="ttdef"><b>Definition:</b> mtx_io.hpp:295</div></div>
<div class="ttc" id="aclassgko_1_1log_1_1Logger_html"><div class="ttname"><a href="classgko_1_1log_1_1Logger.html">gko::log::Logger</a></div><div class="ttdef"><b>Definition:</b> logger.hpp:75</div></div>
<div class="ttc" id="anamespacegko_html_a3ce296f73db0ff398bdea6009a3a5c58"><div class="ttname"><a href="namespacegko.html#a3ce296f73db0ff398bdea6009a3a5c58">gko::share</a></div><div class="ttdeci">detail::shared_type&lt; OwningPointer &gt; share(OwningPointer &amp;&amp;p)</div><div class="ttdoc">Marks the object pointed to by p as shared.</div><div class="ttdef"><b>Definition:</b> utils_helper.hpp:225</div></div>
<div class="ttc" id="aclassgko_1_1CudaExecutor_html_a6c423656c7c0eb53810cb77bb4a66d15"><div class="ttname"><a href="classgko_1_1CudaExecutor.html#a6c423656c7c0eb53810cb77bb4a66d15">gko::CudaExecutor::create</a></div><div class="ttdeci">static std::shared_ptr&lt; CudaExecutor &gt; create(int device_id, std::shared_ptr&lt; Executor &gt; master, bool device_reset, allocation_mode alloc_mode=default_cuda_alloc_mode, CUstream_st *stream=nullptr)</div><div class="ttdoc">Creates a new CudaExecutor.</div></div>
<div class="ttc" id="aclassgko_1_1OmpExecutor_html_a8930142a1913bcbcac4fb6c917f930d9"><div class="ttname"><a href="classgko_1_1OmpExecutor.html#a8930142a1913bcbcac4fb6c917f930d9">gko::OmpExecutor::create</a></div><div class="ttdeci">static std::shared_ptr&lt; OmpExecutor &gt; create(std::shared_ptr&lt; CpuAllocatorBase &gt; alloc=std::make_shared&lt; CpuAllocator &gt;())</div><div class="ttdoc">Creates a new OmpExecutor.</div><div class="ttdef"><b>Definition:</b> executor.hpp:1344</div></div>
<div class="ttc" id="aclassgko_1_1matrix_1_1Dense_html_ab83c739c1b11abaecc3bfd89506f6c9c"><div class="ttname"><a href="classgko_1_1matrix_1_1Dense.html#ab83c739c1b11abaecc3bfd89506f6c9c">gko::matrix::Dense::get_const_values</a></div><div class="ttdeci">const value_type * get_const_values() const noexcept</div><div class="ttdoc">Returns a pointer to the array of values of the matrix.</div><div class="ttdef"><b>Definition:</b> dense.hpp:834</div></div>
<div class="ttc" id="aclassgko_1_1PolymorphicObject_html_ab40586bff071b7f11c2cf6b5cbf598eb"><div class="ttname"><a href="classgko_1_1PolymorphicObject.html#ab40586bff071b7f11c2cf6b5cbf598eb">gko::PolymorphicObject::get_executor</a></div><div class="ttdeci">std::shared_ptr&lt; const Executor &gt; get_executor() const noexcept</div><div class="ttdoc">Returns the Executor of the object.</div><div class="ttdef"><b>Definition:</b> polymorphic_object.hpp:234</div></div>
<div class="ttc" id="anamespacegko_html_afd46d554050c4ae90e84ea4fcd9a41f3"><div class="ttname"><a href="namespacegko.html#afd46d554050c4ae90e84ea4fcd9a41f3">gko::remove_complex</a></div><div class="ttdeci">typename detail::remove_complex_s&lt; T &gt;::type remove_complex</div><div class="ttdoc">Obtain the type which removed the complex of complex/scalar type or the template parameter of class b...</div><div class="ttdef"><b>Definition:</b> math.hpp:325</div></div>
<div class="ttc" id="aclassgko_1_1DpcppExecutor_html_ae9b875dfe3af7f3f3f24071bfb2f895e"><div class="ttname"><a href="classgko_1_1DpcppExecutor.html#ae9b875dfe3af7f3f3f24071bfb2f895e">gko::DpcppExecutor::create</a></div><div class="ttdeci">static std::shared_ptr&lt; DpcppExecutor &gt; create(int device_id, std::shared_ptr&lt; Executor &gt; master, std::string device_type=&quot;all&quot;, dpcpp_queue_property property=dpcpp_queue_property::in_order)</div><div class="ttdoc">Creates a new DpcppExecutor.</div></div>
<div class="ttc" id="anamespacegko_html_af21648097306adbabc6234b4609ce297"><div class="ttname"><a href="namespacegko.html#af21648097306adbabc6234b4609ce297">gko::real</a></div><div class="ttdeci">constexpr auto real(const T &amp;x)</div><div class="ttdoc">Returns the real part of the object.</div><div class="ttdef"><b>Definition:</b> math.hpp:1012</div></div>
<div class="ttc" id="anamespacegko_html_a0059e27f8f4bc348ff65c1e60caf47c8"><div class="ttname"><a href="namespacegko.html#a0059e27f8f4bc348ff65c1e60caf47c8">gko::one</a></div><div class="ttdeci">constexpr T one()</div><div class="ttdoc">Returns the multiplicative identity for T.</div><div class="ttdef"><b>Definition:</b> math.hpp:774</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>

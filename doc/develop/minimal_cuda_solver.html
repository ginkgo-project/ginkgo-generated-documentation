<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ginkgo: The minimal-cuda-solver program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_doc.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Ginkgo
   &#160;<span id="projectnumber">Generated from pipelines/692447160 branch based on develop. Ginkgo version 1.5.0</span>
   </div>
   <div id="projectbrief">A numerical linear algebra library targeting many-core architectures</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The minimal-cuda-solver program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The minimal CUDA solver example..</p>
<p>This example depends on simple-solver.</p>
<p> 
<table class="example" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Abouttheexample"> About the example </a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a>
    <ul>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Commentsaboutprogramminganddebugging"> Comments about programming and debugging </a>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 <a class="anchor" id="Intro"></a> <a class="anchor" id="Introduction"></a></p><h1>Introduction</h1>
<p>This is a minimal example that solves a system with Ginkgo. The matrix, right hand side and initial guess are read from standard input, and the result is written to standard output. The system matrix is stored in CSR format, and the system solved using the CG method, preconditioned with the block-Jacobi preconditioner. All computations are done on the GPU.</p>
<p>The easiest way to use the example data from the data/ folder is to concatenate the matrix, the right hand side and the initial solution (in that exact order), and pipe the result to the minimal_solver_cuda executable:</p>
<div class="fragment"><div class="line">cat data/A.mtx data/b.mtx data/x0.mtx | ./minimal-cuda-solver</div>
</div><!-- fragment --><p><a class="anchor" id="Abouttheexample"></a></p><h3>About the example </h3>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ginkgo/ginkgo.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
</div><!-- fragment --><p>Instantiate a CUDA executor</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> gpu = <a class="code" href="classgko_1_1CudaExecutor.html#a5dcec3ca1c458382e01191b727959a81">gko::CudaExecutor::create</a>(0, <a class="code" href="classgko_1_1OmpExecutor.html#a33ca05fdd0fc928ee262fc9425304874">gko::OmpExecutor::create</a>(), <span class="keyword">true</span>);</div>
</div><!-- fragment --><p>Read data</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> A = gko::read&lt;gko::matrix::Csr&lt;&gt;&gt;(std::cin, gpu);</div>
<div class="line"><span class="keyword">auto</span> b = gko::read&lt;gko::matrix::Dense&lt;&gt;&gt;(std::cin, gpu);</div>
<div class="line"><span class="keyword">auto</span> x = gko::read&lt;gko::matrix::Dense&lt;&gt;&gt;(std::cin, gpu);</div>
</div><!-- fragment --><p>Create the solver</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> solver =</div>
<div class="line">    <a class="code" href="classgko_1_1solver_1_1Cg.html">gko::solver::Cg&lt;&gt;::build</a>()</div>
<div class="line">        .with_preconditioner(<a class="code" href="classgko_1_1preconditioner_1_1Jacobi.html">gko::preconditioner::Jacobi&lt;&gt;::build</a>().on(gpu))</div>
<div class="line">        .with_criteria(</div>
<div class="line">            gko::stop::Iteration::build().with_max_iters(20u).on(gpu),</div>
<div class="line">            <a class="code" href="classgko_1_1stop_1_1ResidualNorm.html">gko::stop::ResidualNorm&lt;&gt;::build</a>()</div>
<div class="line">                .with_reduction_factor(1e-15)</div>
<div class="line">                .on(gpu))</div>
<div class="line">        .on(gpu);</div>
</div><!-- fragment --><p>Solve system</p>
<div class="fragment"><div class="line">solver-&gt;generate(<a class="code" href="namespacegko.html#acbd3fd6d07e498892881e8e2ab0b4167">give</a>(A))-&gt;apply(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">lend</a>(b), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">lend</a>(x));</div>
</div><!-- fragment --><p>Write result</p>
<div class="fragment"><div class="line">    <a class="code" href="namespacegko.html#aa24837da3770b3dddf981d9bfe0d3b52">write</a>(std::cout, <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">lend</a>(x));</div>
<div class="line">}</div>
</div><!-- fragment --><p> <a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>The following is the expected result when using the data contained in the folder <code>data</code> as input:</p>
<div class="fragment"><div class="line">%%MatrixMarket matrix <a class="code" href="namespacegko.html#ae749a5ea11a93c1bcc9158d9a6e9fb68af1f713c9e000f5d3f280adbd124df4f5">array</a> <a class="code" href="namespacegko.html#af21648097306adbabc6234b4609ce297">real</a> general</div>
<div class="line">19 1</div>
<div class="line">0.252218</div>
<div class="line">0.108645</div>
<div class="line">0.0662811</div>
<div class="line">0.0630433</div>
<div class="line">0.0384088</div>
<div class="line">0.0396536</div>
<div class="line">0.0402648</div>
<div class="line">0.0338935</div>
<div class="line">0.0193098</div>
<div class="line">0.0234653</div>
<div class="line">0.0211499</div>
<div class="line">0.0196413</div>
<div class="line">0.0199151</div>
<div class="line">0.0181674</div>
<div class="line">0.0162722</div>
<div class="line">0.0150714</div>
<div class="line">0.0107016</div>
<div class="line">0.0121141</div>
<div class="line">0.0123025</div>
</div><!-- fragment --><p><a class="anchor" id="Commentsaboutprogramminganddebugging"></a></p><h3>Comments about programming and debugging </h3>
<p><a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/*******************************&lt;GINKGO LICENSE&gt;******************************</span></div>
<div class="line"><span class="comment">Copyright (c) 2017-2022, the Ginkgo authors</span></div>
<div class="line"><span class="comment">All rights reserved.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment">modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment">are met:</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">1. Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment">notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">2. Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment">notice, this list of conditions and the following disclaimer in the</span></div>
<div class="line"><span class="comment">documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">3. Neither the name of the copyright holder nor the names of its</span></div>
<div class="line"><span class="comment">contributors may be used to endorse or promote products derived from</span></div>
<div class="line"><span class="comment">this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS</span></div>
<div class="line"><span class="comment">IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED</span></div>
<div class="line"><span class="comment">TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A</span></div>
<div class="line"><span class="comment">PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment">HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment">SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment">LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment">DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment">THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment">(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment">OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment">******************************&lt;GINKGO LICENSE&gt;*******************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;ginkgo/ginkgo.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> gpu = <a class="code" href="classgko_1_1CudaExecutor.html#a5dcec3ca1c458382e01191b727959a81">gko::CudaExecutor::create</a>(0, <a class="code" href="classgko_1_1OmpExecutor.html#a33ca05fdd0fc928ee262fc9425304874">gko::OmpExecutor::create</a>(), <span class="keyword">true</span>);</div>
<div class="line">    <span class="keyword">auto</span> A = gko::read&lt;gko::matrix::Csr&lt;&gt;&gt;(std::cin, gpu);</div>
<div class="line">    <span class="keyword">auto</span> b = gko::read&lt;gko::matrix::Dense&lt;&gt;&gt;(std::cin, gpu);</div>
<div class="line">    <span class="keyword">auto</span> x = gko::read&lt;gko::matrix::Dense&lt;&gt;&gt;(std::cin, gpu);</div>
<div class="line">    <span class="keyword">auto</span> solver =</div>
<div class="line">        <a class="code" href="classgko_1_1solver_1_1Cg.html">gko::solver::Cg&lt;&gt;::build</a>()</div>
<div class="line">            .with_preconditioner(<a class="code" href="classgko_1_1preconditioner_1_1Jacobi.html">gko::preconditioner::Jacobi&lt;&gt;::build</a>().on(gpu))</div>
<div class="line">            .with_criteria(</div>
<div class="line">                gko::stop::Iteration::build().with_max_iters(20u).on(gpu),</div>
<div class="line">                <a class="code" href="classgko_1_1stop_1_1ResidualNorm.html">gko::stop::ResidualNorm&lt;&gt;::build</a>()</div>
<div class="line">                    .with_reduction_factor(1e-15)</div>
<div class="line">                    .on(gpu))</div>
<div class="line">            .on(gpu);</div>
<div class="line">    solver-&gt;generate(<a class="code" href="namespacegko.html#acbd3fd6d07e498892881e8e2ab0b4167">give</a>(A))-&gt;apply(<a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">lend</a>(b), <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">lend</a>(x));</div>
<div class="line">    <a class="code" href="namespacegko.html#aa24837da3770b3dddf981d9bfe0d3b52">write</a>(std::cout, <a class="code" href="namespacegko.html#a014ec51e675c425bb83908361f630450">lend</a>(x));</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="anamespacegko_html_ae749a5ea11a93c1bcc9158d9a6e9fb68af1f713c9e000f5d3f280adbd124df4f5"><div class="ttname"><a href="namespacegko.html#ae749a5ea11a93c1bcc9158d9a6e9fb68af1f713c9e000f5d3f280adbd124df4f5">gko::layout_type::array</a></div><div class="ttdoc">The matrix should be written as dense matrix in column-major order.</div></div>
<div class="ttc" id="anamespacegko_html_acbd3fd6d07e498892881e8e2ab0b4167"><div class="ttname"><a href="namespacegko.html#acbd3fd6d07e498892881e8e2ab0b4167">gko::give</a></div><div class="ttdeci">std::remove_reference&lt; OwningPointer &gt;::type &amp;&amp; give(OwningPointer &amp;&amp;p)</div><div class="ttdoc">Marks that the object pointed to by p can be given to the callee.</div><div class="ttdef"><b>Definition:</b> utils_helper.hpp:234</div></div>
<div class="ttc" id="aclassgko_1_1OmpExecutor_html_a33ca05fdd0fc928ee262fc9425304874"><div class="ttname"><a href="classgko_1_1OmpExecutor.html#a33ca05fdd0fc928ee262fc9425304874">gko::OmpExecutor::create</a></div><div class="ttdeci">static std::shared_ptr&lt; OmpExecutor &gt; create()</div><div class="ttdoc">Creates a new OmpExecutor.</div><div class="ttdef"><b>Definition:</b> executor.hpp:1257</div></div>
<div class="ttc" id="aclassgko_1_1preconditioner_1_1Jacobi_html"><div class="ttname"><a href="classgko_1_1preconditioner_1_1Jacobi.html">gko::preconditioner::Jacobi</a></div><div class="ttdoc">A block-Jacobi preconditioner is a block-diagonal linear operator, obtained by inverting the diagonal...</div><div class="ttdef"><b>Definition:</b> jacobi.hpp:213</div></div>
<div class="ttc" id="aclassgko_1_1stop_1_1ResidualNorm_html"><div class="ttname"><a href="classgko_1_1stop_1_1ResidualNorm.html">gko::stop::ResidualNorm</a></div><div class="ttdoc">The ResidualNorm class is a stopping criterion which stops the iteration process when the actual resi...</div><div class="ttdef"><b>Definition:</b> residual_norm.hpp:137</div></div>
<div class="ttc" id="aclassgko_1_1solver_1_1Cg_html"><div class="ttname"><a href="classgko_1_1solver_1_1Cg.html">gko::solver::Cg</a></div><div class="ttdoc">CG or the conjugate gradient method is an iterative type Krylov subspace method which is suitable for...</div><div class="ttdef"><b>Definition:</b> cg.hpp:74</div></div>
<div class="ttc" id="aclassgko_1_1CudaExecutor_html_a5dcec3ca1c458382e01191b727959a81"><div class="ttname"><a href="classgko_1_1CudaExecutor.html#a5dcec3ca1c458382e01191b727959a81">gko::CudaExecutor::create</a></div><div class="ttdeci">static std::shared_ptr&lt; CudaExecutor &gt; create(int device_id, std::shared_ptr&lt; Executor &gt; master, bool device_reset=false, allocation_mode alloc_mode=default_cuda_alloc_mode)</div><div class="ttdoc">Creates a new CudaExecutor.</div></div>
<div class="ttc" id="anamespacegko_html_aa24837da3770b3dddf981d9bfe0d3b52"><div class="ttname"><a href="namespacegko.html#aa24837da3770b3dddf981d9bfe0d3b52">gko::write</a></div><div class="ttdeci">void write(StreamType &amp;&amp;os, MatrixType *matrix, layout_type layout=detail::mtx_io_traits&lt; std::remove_const_t&lt; MatrixType &gt;&gt;::default_layout)</div><div class="ttdoc">Writes a matrix into an output stream in matrix market format.</div><div class="ttdef"><b>Definition:</b> mtx_io.hpp:324</div></div>
<div class="ttc" id="anamespacegko_html_a014ec51e675c425bb83908361f630450"><div class="ttname"><a href="namespacegko.html#a014ec51e675c425bb83908361f630450">gko::lend</a></div><div class="ttdeci">std::enable_if&lt; detail::have_ownership_s&lt; Pointer &gt;::value, detail::pointee&lt; Pointer &gt; * &gt;::type lend(const Pointer &amp;p)</div><div class="ttdoc">Returns a non-owning (plain) pointer to the object pointed to by p.</div><div class="ttdef"><b>Definition:</b> utils_helper.hpp:256</div></div>
<div class="ttc" id="anamespacegko_html_af21648097306adbabc6234b4609ce297"><div class="ttname"><a href="namespacegko.html#af21648097306adbabc6234b4609ce297">gko::real</a></div><div class="ttdeci">constexpr auto real(const T &amp;x)</div><div class="ttdoc">Returns the real part of the object.</div><div class="ttdef"><b>Definition:</b> math.hpp:1046</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
